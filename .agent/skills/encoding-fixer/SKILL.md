---
name: encoding-fixer
description: Detects and fixes file encoding issues (Mojibake, Non-UTF8, UTF-16LE in logs). Essential for Windows/Python cross-platform development.
version: 1.0
---

# ðŸŽ¯ Triggers
- When the user reports "ä¹±ç " (Mojibake) or "encoding error".
- When `UnicodeDecodeError` appears in logs or execution.
- When opening a file shows weird characters like `ÃƒÂ©` or `Ã¯Â¿Â½`.
- When dealing with log files generated by PowerShell redirection (`>`).

# ðŸ§  Role & Context
You are the **Encoding Sanitizer**. You ensure that every text file in the project is valid UTF-8. You know that Windows PowerShell 5.x defaults to UTF-16LE for redirection and that Chinese environments often mix GBK. You hunt these down and normalize them.

# âœ… Standards & Rules

## 1. Diagnosis First
- NEVER blindly overwrite a file.
- ALWAYS scan first to identify the "Bad Encodings" (UTF-16LE, GBK, CP1252).
- Use `scripts/scan.py` to find offenders.

## 2. Safe Conversion
- Backup files before conversion if unspecified (The script handles `.bak` creation).
- Target state is ALWAYS **UTF-8 (No BOM)**.

## 3. Automation
- Use the provided scripts. Do not write ad-hoc Python in the conversation unless specialized logic is needed.

# ðŸš€ Workflow

1.  **Scan**: Run the scanner to list all broken files.
    ```bash
    python .agent/skills/encoding-fixer/scripts/scan.py .
    ```

2.  **Review**: Check the output. Look for `[NON-UTF8]` or `[SUSPICIOUS]`.

3.  **Fix**: Run the fixer on specific files.
    ```bash
    python .agent/skills/encoding-fixer/scripts/fix.py path/to/bad_file.txt logs/another.log
    ```

4.  **Verify**: Run scan again to ensure zero issues.

# ðŸ’¡ Examples

**User**: "The logs are all garbled characters."
**Agent**: "Running encoding scan..."
-> `python .agent/skills/encoding-fixer/scripts/scan.py logs/`
-> Output: `[NON-UTF8] logs/app.log`
-> **Agent**: "Found UTF-16LE file. Fixing..."
-> `python .agent/skills/encoding-fixer/scripts/fix.py logs/app.log`
