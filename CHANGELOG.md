## ğŸ“… 2026-03-01 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.6.8: å½’æ¡£ç³»ç»Ÿä¼˜åŒ–ä¸ WebUI å¢å¼º (Archive System Update)
- **å¼ºåˆ¶å½’æ¡£åŠŸèƒ½ (Force Archive)**:
    - **API å¢å¼º**: åç«¯ `/api/system/archive/trigger` æ¥å£æ–°å¢ `force` å‚æ•°ï¼Œå…è®¸åœ¨å¿…è¦æ—¶ç»•è¿‡æ•°æ®ä¿æŠ¤å¤©æ•°é™åˆ¶ï¼ˆå¦‚ `HOT_DAYS_LOG` ç­‰ï¼‰ï¼Œç›´æ¥æ¸…ç©º SQLite çƒ­è¡¨å¹¶å°†æ‰€æœ‰æ•°æ®å†™å…¥ Parquet å¯¹è±¡å±‚ã€‚
    - **UI é‡æ„**: Web Admin æ§åˆ¶å°çš„å½’æ¡£é¡µé¢è¿›è¡Œäº†é‡æ„ï¼Œæ‹†åˆ†å‡ºâ€œå¸¸è§„å½’æ¡£â€ä¸â€œå¼ºåˆ¶å½’æ¡£â€ä¸¤ç»„æ“ä½œï¼Œå¹¶é™„å¸¦äº†äºŒæ¬¡ç¡®è®¤å‘Šè­¦ï¼Œå¢å¼ºäº†è¿ç»´äº¤äº’çš„å®‰å…¨æ€§ä¸ä¾¿æºæ€§ã€‚
- **æ„å»ºåŒæ­¥**: æ›´æ–°äº†å‰ç«¯é™æ€äº§ç‰©å¹¶æ‰“åŒ…éƒ¨ç½²ï¼Œå¯¹é½äº†å…¨æ ˆåŠŸèƒ½é“¾è·¯ã€‚

## ğŸ“… 2026-02-21 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.6.7: ä»»åŠ¡é˜Ÿåˆ—è¯¦æƒ…é€è§†ä¸å¤„ç†é“¾å¯è§†åŒ– (Task Queue Detail & Pipeline Visualization)
- **ä»»åŠ¡è¯¦æƒ…å¼¹çª—é‡æ„ (Task Detail Modal)**:
    - **äº¤äº’å‡çº§**: æŠ›å¼ƒæ—§ç‰ˆé€šçŸ¥å•ï¼Œå®ç°å…¨é‡ `Dialog` å¯¹è¯æ¡†å“åº”å¼å¼¹çª—ï¼Œæ”¯æŒç‚¹å‡»ä»»åŠ¡ ID æˆ–è¯¦æƒ…å›¾æ ‡ä¸€é”®ç›´è¾¾ã€‚
    - **å…ƒæ•°æ®é€è§†**: æ”¯æŒåœ¨å¼¹çª—ä¸­å®æ—¶æŸ¥çœ‹ä»»åŠ¡çš„åŸå§‹ JSON å‚æ•° (`task_data`)ã€æ‰§è¡Œè¿›åº¦ (`done_count`/`total_count`) åŠå„é¡¹ç»Ÿè®¡æŒ‡æ ‡ï¼ˆè½¬å‘ã€è¿‡æ»¤ã€å¤±è´¥æ•°ï¼‰ã€‚
- **å¯è§†åŒ–å¤„ç†é“¾ (Visual Processing Chain)**:
    - **å…¨é“¾è·¯è¿½è¸ª**: ä¸ºæ¶ˆæ¯å¤„ç†ä»»åŠ¡å¼•å…¥å¯è§†åŒ–æ­¥éª¤æ¡ï¼Œæ¶µç›– `å‡†å¤‡` -> `è§„åˆ™åŒ¹é…` -> `å»é‡æ£€æŸ¥` -> `å†…å®¹è¿‡æ»¤` -> `æ‰§è¡Œè½¬å‘` å…¨æµç¨‹ã€‚
    - **å¼‚å¸¸æ„Ÿåº”è¯Šæ–­**: å‰ç«¯æ ¹æ®é”™è¯¯æ—¥å¿—å…³é”®å­—ï¼ˆå¦‚ `rule`, `dedup`, `filter`ï¼‰è‡ªåŠ¨å®šä½å¹¶æ ‡çº¢å¤±è´¥ç¯èŠ‚ï¼Œæå¤§ç¼©çŸ­äº†è¿ç»´æ’æŸ¥æ—¶é—´ã€‚
- **åç«¯ API ä¸ä»“åº“ä¼˜åŒ–**:
    - **ä»“åº“å±‚å¢å¼º**: `TaskRepository` æ–°å¢ `get_task_by_id` ç‰©ç†æŸ¥è¯¢æ–¹æ³•ï¼Œç¡®ä¿åªè¯»äº‹åŠ¡ä¸‹é«˜æ€§èƒ½è·å–å®Œæ•´ä»»åŠ¡å¿«ç…§ã€‚
    - **API æ‰©å±•**: æ‰©å±•äº† `/api/system/tasks/{task_id}` æ¥å£ï¼Œè¡¥å…¨äº† `error_log` (å¼‚å¸¸å †æ ˆ)ã€`started_at`ã€`completed_at` ç­‰å…³é”®æ²»ç†å­—æ®µã€‚
- **å‰ç«¯å·¥ç¨‹ç¨³å¥æ€§**:
    - **åŠ è½½çŠ¶æ€ç»†åŒ–**: å¼•å…¥ `loadingTaskId` çŠ¶æ€é”ï¼Œå°† Loading åŠ¨ç”»ç²¾å‡†é”å®šåœ¨è§¦å‘ä»»åŠ¡è¡Œï¼Œæ¶ˆé™¤å…¨å±€ UI é—ªçƒã€‚
    - **æ„å»ºåŒæ­¥**: å®Œæˆäº† React ç¼–è¯‘äº§ç‰©çš„å¢é‡æ›´æ–°ï¼Œç¡®ä¿è¿œç¨‹ä»“åº“ä¸­çš„ `dist` ç›®å½•ä¸æœ€æ–°åŠŸèƒ½é€»è¾‘å®Œå…¨åŒæ­¥ã€‚

## ğŸ“… 2026-02-19 æ›´æ–°æ‘˜è¦


### ğŸš€ v1.2.6.6: è½¬å‘è¯¦ç»†ç»Ÿè®¡ä¿®å¤ä¸æ•°æ®é“¾è·¯ä¼˜åŒ– (Forward Stats & DuckDB Bridge Fix)
- **ç»Ÿè®¡é¢æ¿ä¿®å¤ (Fix Forward Stats)**:
    - **å‘¨æœŸä¸ç±»å‹ä¿®å¤**: ä¿®å¤äº†â€œè½¬å‘è¯¦ç»†ç»Ÿè®¡â€é¢æ¿ä¸­å‘¨æœŸæ˜¾ç¤ºä¸ºé—®å· (`? days`) åŠå†…å®¹ç±»å‹åˆ†å¸ƒæ˜¾ç¤ºä¸º `Unknown` çš„é—®é¢˜ã€‚
    - **æ•°æ®å®Œæ•´æ€§**: `AdminController` ç°åˆ‡æ¢è‡³æ›´å®Œæ•´çš„ `get_detailed_analytics` æ¥å£ï¼Œç¡®ä¿ `summary` (æ€»é‡ã€é”™è¯¯æ•°) å’Œ `period` (æ—¥æœŸèŒƒå›´) å­—æ®µå‡†ç¡®ä¼ é€’è‡³å‰ç«¯æ¸²æŸ“å™¨ã€‚
    - **ç±»å‹è¯†åˆ«å›é€€**: ä¼˜åŒ–äº† `AnalyticsService` çš„ç±»å‹è§£æé€»è¾‘ï¼Œå½“æ•°æ®åº“ä¸­ `message_type` ä¸º `NULL` æ—¶è‡ªåŠ¨å›é€€ä¸º `"Text"`ï¼Œæ¶ˆé™¤äº†è¯¯å¯¼æ€§çš„ `Unknown` åˆ†ç±»ã€‚
- **DuckDB æ¡¥æ¥æ­»é”ä¿®å¤ (Bridge Deadlock Fix)**:
    - **æ­»é”æ ¹å› æ¶ˆé™¤**: ç§»é™¤äº† `get_detailed_analytics` ä¸­ä¸å¿…è¦çš„å¤–å±‚ SQLAlchemy Session äº‹åŠ¡é”ã€‚æ­¤é”æ›¾å¯¼è‡´ DuckDB (`UnifiedQueryBridge`) åœ¨å°è¯•è¯»å– SQLite æ–‡ä»¶æ—¶ä¸å¤–å±‚ Python äº‹åŠ¡å‘ç”Ÿ Read-Write å†²çªï¼Œå¼•å‘æŸ¥è¯¢æŒ‚èµ·ã€‚
    - **æ— é”èšåˆæŸ¥è¯¢**: éªŒè¯äº†åœ¨æ— å¤–å±‚äº‹åŠ¡åŒ…è£¹çš„æƒ…å†µä¸‹ï¼ŒDuckDB èƒ½å¤Ÿå®‰å…¨ã€é«˜æ•ˆåœ°å¯¹ `chat_statistics` å’Œ `rule_logs` è¡¨è¿›è¡Œé«˜æ€§èƒ½ OLAP èšåˆæŸ¥è¯¢ã€‚
- **Top ç»´åº¦å¢å¼º**:
    - **Top Chats ä¿®å¤**: ä¿®æ­£äº†çƒ­é—¨é¢‘é“ç»Ÿè®¡é€»è¾‘ï¼Œä»ä¸“é—¨çš„ `chat_statistics` è¡¨ï¼ˆæ”¯æŒå½’æ¡£æ•°æ®ï¼‰æŸ¥è¯¢ï¼Œè€Œéä¾èµ–ä¸åŒ…å« `source_chat_id` ç´¢å¼•çš„ `rule_logs` è¡¨ï¼Œæå¤§æå‡äº†æŸ¥è¯¢æ•ˆç‡ä¸å‡†ç¡®æ€§ã€‚
    - **è·¨å¤©èšåˆ**: ç¡®ä¿æ‰€æœ‰ Top æ¦œå•ï¼ˆè§„åˆ™ã€é¢‘é“ã€ç±»å‹ï¼‰å‡ä¸¥æ ¼æŒ‰ç…§ç”¨æˆ·é€‰æ‹©çš„æ—¶é—´èŒƒå›´ï¼ˆå¦‚ 7 å¤©ï¼‰è¿›è¡Œèšåˆï¼Œè€Œéä»…å±•ç¤ºå½“æ—¥æ•°æ®ã€‚
- **éªŒè¯**:
    - **æ¨¡æ‹Ÿæµ‹è¯•**: é€šè¿‡ `test_analytics.py` éªŒè¯äº† API çš„å“åº”ç»“æ„å®Œæ•´æ€§åŠé«˜å¹¶å‘ä¸‹çš„æ— æ­»é”è¡¨ç°ã€‚

## ğŸ“… 2026-02-19 æ›´æ–°æ‘˜è¦

###  [Hotfix] SQLite é”ç«äº‰æ ¹å› æ¶ˆé™¤ä¸å…¨é“¾è·¯åªè¯»ä¼˜åŒ– (Database Lock Contention Root-Cause Fix)
- **å†™äº‹åŠ¡åŸå­åŒ–é‡æ„ (Write Transaction Atomization)**:
    - **çº¯ UPDATE æ¨¡å¼**: å°† `TaskRepository` çš„ `complete()` / `fail()` / `reschedule()` ä»ã€ŒSELECT éªŒè¯çŠ¶æ€ â†’ UPDATE æ›´æ–°ã€ä¸¤æ­¥æ“ä½œé‡æ„ä¸º**çº¯ `UPDATE ... WHERE status IN(...)` å•æ­¥æ“ä½œ**ï¼ˆä¹è§‚é”æ¨¡å¼ï¼‰ã€‚
    - **æ•ˆæœ**: æ¯ä¸ªå†™äº‹åŠ¡çš„é”æŒæœ‰æ—¶é—´ä» ~2æ¬¡æ•°æ®åº“å¾€è¿”ç¼©çŸ­è‡³ ~1æ¬¡ï¼Œç›´æ¥å°†å†™é”çª—å£å‡åŠã€‚
- **å…¨é“¾è·¯åªè¯» Session ä¼˜åŒ– (Read-Only Session Sweep)**:
    - **è¦†ç›–èŒƒå›´**: ç³»ç»Ÿæ€§åœ°ä¸º 6 ä¸ª Repository ä¸­æ‰€æœ‰çº¯æŸ¥è¯¢æ–¹æ³•å¯ç”¨ `readonly=True`ï¼Œå®Œå…¨ç»•è¿‡ `BEGIN IMMEDIATE` å†™é”ï¼š
        - `UserRepository`: 8 ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼ˆ`get_user_by_username`, `get_user_for_auth`, `get_all_users`, `get_user_by_id`, `get_user_auth_by_id`, `get_user_count`, `get_user_by_telegram_id`, `get_admin_by_telegram_id`ï¼‰
        - `DedupRepository`: 4 ä¸ªæŸ¥è¯¢æ–¹æ³•ï¼ˆ`find_by_signature`, `find_by_file_id_or_hash`, `get_duplicates`, `load_config`ï¼‰
        - `AuditRepository`: `get_logs` åˆ†é¡µæŸ¥è¯¢
        - `RuleRepository`: `get_rules_for_target_chat` (å·²å…ˆå‰ä¼˜åŒ–)
        - `StatsRepository`: `get_hourly_trend`, `get_rules_stats_batch` (å·²å…ˆå‰ä¼˜åŒ–)
        - `TaskRepository`: `get_queue_status`, `get_rule_stats`, `get_tasks` (å·²å…ˆå‰ä¼˜åŒ–)
    - **æ•ˆæœ**: è¯»æ“ä½œä¸å†ä¸å†™æ“ä½œç«äº‰åŒä¸€æŠŠé”ï¼Œé«˜é¢‘æŸ¥è¯¢è·¯å¾„ï¼ˆè®¤è¯ã€å»é‡æ£€æŸ¥ã€API å±•ç¤ºï¼‰çš„å»¶è¿Ÿæ˜¾è‘—é™ä½ã€‚
- **é‡è¯•å™¨æƒŠç¾¤æ•ˆåº”é˜²æ²» (Retry Jitter Anti-Thundering Herd)**:
    - ä¸º `async_db_retry` è£…é¥°å™¨å¼•å…¥ **Â±30% éšæœº Jitter**ï¼Œé˜²æ­¢å¤š Worker çš„é‡è¯•åœ¨å®Œå…¨ç›¸åŒçš„æ—¶é—´ç‚¹åŒæ­¥ç¢°æ’é”ã€‚
    - åŸºç¡€é€€é¿å»¶è¿Ÿä» `0.2s` æå‡è‡³ `0.3s`ï¼Œç»™ SQLite WAL æ›´å¤šçš„ Checkpoint ç¼“å†²ã€‚
- **StatsRepository Commit ä½ç½® Bug ä¿®å¤**:
    - ä¿®å¤äº† `increment_stats()` å’Œ `increment_rule_stats()` ä¸­ `await session.commit()` å†™åœ¨ `async with` å—**å¤–éƒ¨**çš„ä¸¥é‡ Bugï¼ˆsession åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨é€€å‡ºåå·²å…³é—­ï¼Œæ­¤æ—¶ commit ä¼šäº§ç”Ÿå¹½çµäº‹åŠ¡åŠ å‰§é”ç«äº‰ï¼‰ã€‚
- **busy_timeout æ‰©å®¹**:
    - SQLite `PRAGMA busy_timeout` ä» `30s` æ‰©å®¹è‡³ `60s`ï¼Œåœ¨é©±åŠ¨å±‚æä¾›æ›´å……è¶³çš„é”ç­‰å¾…çª—å£ã€‚

### ğŸš€ [Hotfix] VPS é«˜è´Ÿè½½ (300%) ä¿®å¤ä¸å¹¶å‘ä¼˜åŒ– (VPS High Load Fix & Concurrency Optimization)
- **WorkerService ä¼¸ç¼©é€»è¾‘é‡æ„**:
    - **èµ„æºå“¨å…µ**: æ‰©å®¹å‰å¼ºåˆ¶æ ¡éªŒ CPU (<80%)ã€ç³»ç»Ÿè´Ÿè½½ (LoadAvg) ä¸å†…å­˜å ç”¨ï¼Œé˜²æ­¢è¿‡è½½æ‰©å®¹ã€‚
    - **å¹¶å‘çº å**: å°†æ¯ä¸ª Worker çš„ä»»åŠ¡æ‹‰å–é™åˆ¶ä» 10 é™è‡³ **1**ï¼Œç¡®ä¿æ•°æ®åº“ `running` æ•°ä¸å®é™… Worker æ•°ä¸¥æ ¼å¯¹é½ã€‚
    - **ç´§æ€¥ç¼©å®¹**: ç›‘æ§åˆ° CPU > 95% æ—¶ä¸»åŠ¨å›ç¼© Worker æ•°é‡ï¼Œä¼˜å…ˆä¿éšœç³»ç»Ÿå­˜æ´»ã€‚
- **ä»»åŠ¡è‡ªæ„ˆæ•‘æ´ (Zombie Task Rescue)**:
    - å®ç°å¯åŠ¨è‡ªæ£€ä¸åˆ†é’Ÿçº§å·¡æ£€ï¼Œè‡ªåŠ¨é‡ç½®é•¿æ—¶é—´å¡åœ¨ `running` çŠ¶æ€çš„åƒµå°¸ä»»åŠ¡ä¸º `pending`ã€‚
- **API æ€§èƒ½è°ƒä¼˜**:
    - **æ—¥å¿—é™å™ª**: å°†é«˜é¢‘å®ä½“è·å–å¤±è´¥é¢„è­¦ç”± `Warning` é™çº§ä¸º `Debug`ï¼Œå‡å°‘ IO ä¹¦å†™æŸè€—ã€‚
    - **è®©æƒé€»è¾‘**: åœ¨å®ä½“è§£æå¾ªç¯ä¸­åŠ å…¥ç²¾å‡† `yield` (sleep)ï¼Œç¡®ä¿ä¸é•¿æ—¶é—´é˜»å¡äº‹ä»¶å¾ªç¯ã€‚
- **æ¶æ„å‡€åŒ–**:
    - ä¿®å¤äº† `repositories` å±‚å¯¹ `services` å±‚çš„éæ³•ä¾èµ–ï¼Œå°†é—ç•™å¤‡ä»½æ¡¥æ¥é€»è¾‘è¿ç§»è‡³ `services/legacy_backup_bridge.py`ã€‚

## ğŸ“… 2026-02-18 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.6.5: SQLite ç¨³å®šæ€§ä¸é”å®šä¿®å¤ä¸“é¡¹ (SQLite Stability & Lock Mitigation)
- **å¼‚æ­¥é‡è¯•æœºåˆ¶ (Async DB Retry)**:
    - **async_db_retry**: æ–°å»º `core/helpers/db_utils.py`ï¼Œå®ç°æ™ºèƒ½å¼‚æ­¥é‡è¯•è£…é¥°å™¨ï¼Œæ”¯æŒæŒ‡æ•°é€€é¿ (Exponential Backoff) ä¸éšæœºæŠ–åŠ¨ (Jitter)ã€‚
    - **é€»è¾‘æ‹¦æˆª**: ä»…é’ˆå¯¹ `OperationalError` ä¸­çš„é”å®š/å¿™ç¢ŒçŠ¶æ€ (`locked`, `busy`) è¿›è¡Œé‡è¯•ï¼Œç¡®ä¿ç¬æ€å†²çªå¯è‡ªæ„ˆã€‚
    - **å…¨é“¾è·¯è¦†ç›–**: å…³é”®å†™å…¥è·¯å¾„ï¼ˆ`TaskRepository`, `StatsRepository`, `DedupRepository`ï¼‰å·²å…¨é¢æ¥å…¥é‡è¯•ä¿æŠ¤ã€‚
- **SQLite é…ç½®è°ƒä¼˜ (PRAGMA Optimization)**:
    - **busy_timeout**: å°†æ•°æ®åº“ç¹å¿™è¶…æ—¶æ—¶é—´ä» 5s æš´åŠ›æå‡è‡³ **30s**ï¼Œå¤§å¹…ç¼“è§£æç«¯å¹¶å‘ä¸‹çš„é”å¼‚å¸¸ã€‚
    - **æè‡´æ€§èƒ½å‚æ•°**: æ·±åº¦åŒæ­¥ `synchronous=NORMAL`, `temp_store=MEMORY`, `cache_size=-64000` (64MB) ç­‰å‚æ•°è‡³ `Database` æ ¸å¿ƒåŠ `DbFactory`ã€‚
    - **WAL æ²»ç†**: é™åˆ¶ WAL æ–‡ä»¶å¤§å° (`journal_size_limit=20MB`)ï¼Œåœ¨ä¿è¯é«˜æ€§èƒ½çš„åŒæ—¶å…¼é¡¾ç£ç›˜å«ç”Ÿã€‚
- **å…¼å®¹æ€§ä¿éšœ**:
    - ä¸ºæ—§ç‰ˆæœ¬ä»£ç ä¿ç•™äº† `retry_on_db_lock` åˆ«åï¼Œç¡®ä¿å¹³æ»‘é‡æ„ã€‚
- **éªŒè¯çŸ©é˜µ**:
    - å·²é€šè¿‡ `test_task_repo.py` å¹¶è¡Œå‹æµ‹æ¨¡æ‹ŸåŠ `py_compile` é™æ€è¯­æ³•åˆ†æã€‚

### ğŸš€ v1.2.6.4: çƒ­å†·åˆ†å±‚å­˜å‚¨ä¸ä¸‡èƒ½å½’æ¡£ç³»ç»Ÿ (Phase 6+)
- **åˆ†å±‚å­˜å‚¨æ¶æ„ (Tiered Storage)**:
    - **UniversalArchiver**: å®ç°äº†é€šç”¨çš„ä¸‡èƒ½å½’æ¡£å¼•æ“ï¼Œæ”¯æŒå°†ä»»ä½•å¸¦æœ‰æ—¶é—´æˆ³çš„æ¨¡å‹æ•°æ®å½’æ¡£è‡³ Parquet å†·å­˜å‚¨ã€‚
    - **UnifiedQueryBridge**: å¼•å…¥åŸºäº DuckDB çš„ç»Ÿä¸€æŸ¥è¯¢æ¡¥æ¥ï¼Œæ”¯æŒåŒæ—¶ä» SQLite (Hot) å’Œ Parquet (Cold) ä¸­è”é‚¦æŸ¥è¯¢æ•°æ®ã€‚
- **ç»Ÿä¸€å¤‡ä»½ç³»ç»Ÿ (Unified Backup System)**:
    - **BackupService**: å»ºç«‹ä¸­å¤®å¤‡ä»½æœåŠ¡ï¼Œæ•´åˆäº†ä»£ç å‹ç¼© (.zip) ä¸æ•°æ®åº“åœ¨çº¿å¤‡ä»½ (.bak) é€»è¾‘ã€‚
    - **åœ¨çº¿æ•°æ®åº“å¤‡ä»½**: å¼•å…¥ SQLite `backup` APIï¼Œæ”¯æŒåœ¨ç³»ç»Ÿè¿è¡Œä¸­è¿›è¡Œå®‰å…¨ã€äº‹åŠ¡ä¸€è‡´çš„æ•°æ®åº“å¤‡ä»½ï¼Œè‡ªåŠ¨é™çº§ä¸ºæ–‡ä»¶æ‹·è´åŠ é€Ÿã€‚
    - **ç‹¬ç«‹æ—‹è½¬æœºåˆ¶**: å®ç°äº†ä»£ç ä¸æ•°æ®åº“çš„ç‹¬ç«‹ç‰ˆæœ¬æ—‹è½¬ (Rotation)ï¼Œé»˜è®¤ä¿ç•™å„ 10 ä¸ªæœ€æ–°å¤‡ä»½ã€‚
    - **å…¨é“¾è·¯åˆ†å±‚é‡æ„**: æ›´æ–°æœåŠ¡ (`UpdateService`)ã€ç³»ç»Ÿç»´æŠ¤ (`SystemService/DBMaintenanceService`) åŠ Web ç®¡ç†ç«¯å·²å…¨é¢åˆ‡æ¢è‡³ç»Ÿä¸€å¤‡ä»½åè®®ï¼ŒåºŸå¼ƒäº†å†…éƒ¨å†—ä½™å®ç°ã€‚
    - **CLI å¢å¼º**: `manage_update.py` ç°åœ¨æ”¯æŒåˆ†ç±»æŸ¥çœ‹ä¸è·¯ç”±è¿˜åŸï¼ˆä»£ç  vs æ•°æ®åº“ï¼‰ï¼Œæä¾›æ›´å®‰å…¨çš„è¿˜åŸä¿éšœã€‚
- **æœåŠ¡å±‚æ·±åº¦é›†æˆ (Service Integration)**:
    - **TaskService**: ä»»åŠ¡åˆ—è¡¨ä¸è¯¦æƒ…æŸ¥è¯¢ç°å·²å®Œå…¨æ¥å…¥æ¡¥æ¥å™¨ï¼Œæ”¯æŒæŸ¥çœ‹å·²å½’æ¡£çš„ 60w+ å†å²ä»»åŠ¡ã€‚
    - **AuditService**: å®¡è®¡æ—¥å¿—æŸ¥è¯¢å®ç°è·¨å±‚çº§è”åˆï¼Œç¡®ä¿æŒä¹…åŒ–å®¡è®¡è®°å½•çš„å¯å›æº¯æ€§ã€‚
    - **AnalyticsService**: ç»Ÿè®¡åˆ†æåŠŸèƒ½å…¨é¢é€‚é…è”é‚¦æŸ¥è¯¢ï¼Œå‡†ç¡®åæ˜ çƒ­å†·åº“ç»¼åˆæ•°æ®ã€‚
- **è¿ç»´ä¸æ€§èƒ½ä¼˜åŒ– (Ops & Performance)**:
    - **ä¿ç•™ç­–ç•¥**: å°† `task_queue` é»˜è®¤çƒ­æ•°æ®ä¿ç•™æœŸé™ç”± 7 å¤©ç¼©çŸ­è‡³ 1 å¤©ï¼Œæå¤§å‡è½»ä¸»åº“è´Ÿæ‹…ã€‚
    - **ç©ºé—´å›æ”¶**: è‡ªåŠ¨åŒ–å½’æ¡£æµç¨‹é›†æˆ `WAL Checkpoint` ä¸ `VACUUM`ï¼Œå®ç°æè‡´çš„ä¸»åº“ç£ç›˜ç©ºé—´å›æ”¶ã€‚
    - **æµ‹è¯•è´¨é‡**: ä¿®å¤äº†å½’æ¡£å•å…ƒæµ‹è¯•ä¸­çš„ SQLAlchemy Mock å…¼å®¹æ€§é—®é¢˜ (`ArgumentError`)ã€‚

## ğŸ“… 2026-02-16 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.6.1: MenuController åŠé¢†åŸŸæ§åˆ¶å™¨æ¶æ„æ ‡å‡†åŒ–é‡æ„ (UIRE-3.0)
- **CVM æ¶æ„æ·±åº¦é‡æ„ (Architecture)**:
    - **æ ¸å¿ƒè§£è€¦**: å½»åº•åˆ†ç¦»äº† `MenuController` ä¸ `Media/Rule/Admin` æ§åˆ¶å™¨ä¸­çš„ UI æ„é€ é€»è¾‘ã€‚æ§åˆ¶å™¨ç°ä»…è´Ÿè´£ä¸šåŠ¡è°ƒåº¦ï¼Œä¸å†æŒæœ‰ä»»ä½•ç¡¬ç¼–ç çš„æ ‡é¢˜æˆ–å¯¼èˆªå­—ç¬¦ä¸²ã€‚
    - **ç»Ÿä¸€æ¸²æŸ“å…¥å£**: å¼•å…¥ `BaseMenu.display_view` æ–¹æ³•ï¼Œå®ç°äº†å¯¹ `ViewResult` äº§ç‰©çš„æ ‡å‡†åŒ–åˆ†å‘ï¼Œç¡®ä¿å…¨ç³»ç»Ÿæ¸²æŸ“è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚
- **UI æ¸²æŸ“å¼•æ“å‡çº§ (UI Engine)**:
    - **æ¸²æŸ“å†…èšåŒ–**: å°†åˆ†å‰²çº¿ã€æ ‡é¢˜å›¾æ ‡ã€æ ‡å‡†é¢åŒ…å±‘åŠåŠ¨æ€â€œæ›´æ–°æ—¶é—´â€è„šæ³¨å®Œå…¨å°è£…åœ¨ `Renderer` å±‚ï¼ˆåŸºäº `MenuBuilder`ï¼‰ï¼Œå®ç°äº† UI ç»“æ„çš„ä¸­å¤®ç®¡æ§ã€‚
    - **Emoji ä¸æ’ç‰ˆä¿®å¤**: ä¿®å¤äº†ç”±äºåŒé‡å¤åˆå¯¼è‡´çš„ Telegram æ¶ˆæ¯åŒé‡æ ‡é¢˜é—®é¢˜ï¼Œå¹¶ä¼˜åŒ–äº† Emoji æ ‡é¢˜åœ¨å„ç«¯æ˜¾ç¤ºçš„ä¸€è‡´æ€§ã€‚
- **è´¨é‡ä¿éšœ (Quality)**:
    - **è·¯ç”±åˆè§„**: ç¡®ä¿æ‰€æœ‰èœå•äº¤äº’æŒ‰é’®ï¼ˆå¦‚å†å²è®°å½•ã€è§„åˆ™ç®¡ç†ç­‰ï¼‰å¿…é¡»ç»ç”±ç›¸åº”çš„ Controller è½¬å‘ï¼Œä¸¥æ ¼å¯¹é½äº† PSB å·¥ç¨‹åè®®çš„åˆ†å±‚è¦æ±‚ã€‚
    - **å…¨é‡éªŒè¯**: é€šè¿‡æœ¬åœ° CI (Arch Guard & Flake8 Critical) æ£€æŸ¥ã€‚

### ğŸš€ v1.2.6.0: Web ç®¡ç†ç«¯æœåŠ¡ç«¯æœç´¢ä¸åˆ†é¡µåŠŸèƒ½å‡çº§ (Server-side Search & Pagination)
- **æ ¸å¿ƒåç«¯å¢å¼º (Core Backend)**:
    - **ä»“åº“æœç´¢æ”¯æŒ**: æ›´æ–°äº† `RuleRepository.get_all` å’Œ `StatsRepository.get_rule_logs`ï¼Œæ”¯æŒé€šè¿‡å…³é”®è¯å¯¹è§„åˆ™è¯¦æƒ…åŠè½¬å‘æ—¥å¿—è¿›è¡ŒæœåŠ¡ç«¯é«˜æ•ˆè¿‡æ»¤ã€‚
    - **API è¯­ä¹‰åŒ–**: ç»Ÿä¸€äº†è§„åˆ™åˆ—è¡¨ä¸æ—¥å¿—åˆ—è¡¨çš„æœç´¢æ¥å£åè®®ï¼Œæ–°å¢ `query` å¯é€‰å‚æ•°ï¼Œæå‡äº†å‰åç«¯æ•°æ®äº¤æ¢çš„çµæ´»æ€§ã€‚
- **å‰ç«¯äº¤äº’é‡æ„ (Frontend UI/UX)**:
    - **å®æ—¶æœç´¢é˜²æŠ–**: åœ¨ Rules å’Œ History é¡µé¢å¼•å…¥ `debounce` æœºåˆ¶ï¼Œç¡®ä¿æœç´¢æ¡†è¾“å…¥æ—¶èƒ½æ™ºèƒ½å»¶è¿Ÿè§¦å‘ API è¯·æ±‚ï¼Œå¤§å¹…æå‡é¡µé¢å“åº”æ€§èƒ½ã€‚
    - **å¤šç»´åº¦åˆ†é¡µ**: åœ¨ Rules é¡µé¢å®ç°äº†å®Œæ•´çš„æœåŠ¡ç«¯åˆ†é¡µæ§åˆ¶ï¼Œæ”¯æŒå¤§è§„æ¨¡è§„åˆ™é›†çš„æµç•…æµè§ˆã€‚
    - **çº§è”å¯¼èˆªè¿‡æ»¤**: å†å²è®°å½•é¡µé¢ç°åœ¨æ”¯æŒé€šè¿‡ URL å‚æ•° (`rule_id`) è¿›è¡Œç²¾å‡†è¿‡æ»¤ï¼Œå¹¶å¢åŠ äº†ä»è§„åˆ™å¡ç‰‡â€œæŸ¥çœ‹å†å²â€çš„ä¸€é”®ç›´è¾¾é“¾è·¯ã€‚
- **è´¨é‡ä¸ä¿®å¤ (Fixes)**:
    - **TypeScript ç±»å‹ä¿®å¤**: ä¿®å¤äº† `History.tsx` ä¸­çš„æ— ç”¨å¯¼å…¥åŠ TS æ ¡éªŒé”™è¯¯ï¼Œç¡®ä¿äº†ç”Ÿäº§ç¯å¢ƒä¸‹æ„å»ºæµæ°´çº¿çš„é€šå…³ã€‚
    - **UI çŠ¶æ€åŒæ­¥**: ä¿®å¤äº†åˆ†é¡µåˆ‡æ¢æ—¶æœç´¢çŠ¶æ€ä¸¢å¤±çš„é—®é¢˜ï¼Œç¡®ä¿äº† UI å±•ç¤ºä¸åç«¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚
    - **æ„å»ºéªŒè¯**: å·²å®Œæˆæœ¬åœ° `npm run build` éªŒè¯ï¼Œäº§ç‰©å·²æˆåŠŸç”Ÿæˆå¹¶å‡†å¤‡åˆ†å‘ã€‚

### ğŸ”§ v1.2.5.5: ç³»ç»Ÿæ›´æ–°/é‡éƒ¨ç½²äº¤äº’ä½“éªŒä¿®å¤ (System Update UI Fix)
- **UI äº¤äº’ä¼˜åŒ–**:
    - **å–æ¶ˆæŒ‰é’®ä¿®å¤**: ä¿®å¤äº†ç³»ç»Ÿæ›´æ–°ä¸å›æ»šç¡®è®¤é¡µé¢â€œå–æ¶ˆâ€æŒ‰é’®è§¦å‘â€œæ— æ•ˆæŒ‡ä»¤â€çš„é—®é¢˜ã€‚ç”±äºåŸæŒ‰é’® `data="delete"` è·¯ç”±ç¼ºä¹ `rule_id` ä¸”æœªåœ¨è§£æå…æ ¡éªŒåå•ä¸­ï¼Œå¯¼è‡´æ‹¦æˆªæŠ¥é”™ã€‚
    - **è·¯ç”±æŒ‡ä»¤å¯¹é½**: å°†â€œå–æ¶ˆâ€æŒ‰é’®æ•°æ®ç»Ÿä¸€é‡æ„ä¸º `"cancel"`ï¼Œå¹¶å°†å…¶å…³è”è‡³é€šç”¨çš„ `callback_close_settings` å¤„ç†å™¨ã€‚
    - **è·¯ç”±å™¨é²æ£’æ€§**: åœ¨ `callback_handlers.py` ä¸­è¡¥å…¨äº†å¯¹ `cancel` å’Œ `close_settings` æŒ‡ä»¤çš„å… ID æ ¡éªŒé€»è¾‘ï¼Œç¡®ä¿æ­¤ç±»å…¨å±€æ€§æ“ä½œæ— éœ€ä¸šåŠ¡ ID å³å¯æˆåŠŸåˆ†å‘ã€‚
- **è´¨é‡éªŒè¯**:
    - **è·¯ç”±å•å…ƒæµ‹è¯•**: æ–°å¢éªŒè¯é€»è¾‘ç¡®è®¤ `RadixRouter` èƒ½æ­£ç¡®åŒ¹é…å¹¶åˆ†å‘ `cancel` è·¯å¾„ã€‚

### ğŸ”§ v1.2.5.4: ç³»ç»Ÿç¨³å®šæ€§ä¸ä»£ç è´¨é‡ä¸“é¡¹ä¼˜åŒ– (System Stability & Code Quality Review)
- **ä»£ç è´¨é‡æ²»ç† (Code Quality)**:
    - **Undefined Name ä¿®å¤**:
        - `AnalyticsService`: ä¿®å¤ `_resolve_chat_name` ä¸­å¼•ç”¨æœªå®šä¹‰çš„ `session_service`ï¼Œä¿®æ­£ä¸º `self.container.chat_info_service`ã€‚
        - `AdminController`: ä¿®å¤ `execute_admin_cleanup_logs` ä¸­ `deleted_count` æœªå®šä¹‰çš„é—®é¢˜ï¼›è¡¥å……ç¼ºå¤±çš„ `os` å’Œ `datetime` å¼•ç”¨ã€‚
        - `other_callback.py`: ä¿®å¤ `handler_map` ä¸­æŒ‡å‘æœªå®šä¹‰çš„ `callback_delete_duplicates`ï¼Œä¿®æ­£ä¸º `callback_confirm_delete_duplicates`ã€‚
    - **æœªä½¿ç”¨å¼•ç”¨æ¸…ç†**: ç§»é™¤ `stats_router.py` ä¸­æœªä½¿ç”¨çš„ `validate_transition` å¯¼å…¥ã€‚

### ğŸš€ v1.2.5.3: Web ç®¡ç†ç•Œé¢ç¨³å®šæ€§ä¸é²æ£’æ€§ä¿®å¤ (Web Admin Stability & Robustness)
- **æœç´¢ç»Ÿè®¡å¢å¼º**:
    - **Unknown å®ä½“ä¿®å¤**: å½»åº•ä¿®å¤äº†â€œè½¬å‘è®°å½•â€æœç´¢è¯¦æƒ…ä¸­ï¼Œæ¥æº/ç›®æ ‡å®ä½“æ˜¾ç¤ºä¸º `Unknown` çš„ Bugã€‚é€šè¿‡åœ¨ `AnalyticsService.search_records` ä¸­å¢åŠ å¯¹ `SourceChat` å’Œ `TargetChat` çš„æ·±åº¦é¢„åŠ è½½ (`joinedload`)ï¼Œç¡®ä¿äº†å®ä½“åç§°çš„å®æ—¶è§£æã€‚
    - **æ•°æ®æ ¼å¼å¯¹é½**: ä¼˜åŒ–äº†æœç´¢ç»“æœçš„ DTO æ˜ å°„ï¼Œæ–°å¢ `source_chat` å’Œ `target_chat` å­—æ®µä»¥åŒ¹é… `RuleDTOMapper` è§„èŒƒï¼Œæå‡äº†å‰åç«¯æ•°æ®äº¤æ¢çš„ä¸€è‡´æ€§ã€‚
- **ä»»åŠ¡ç³»ç»Ÿé²æ£’æ€§**:
    - **æ—¥æœŸåºåˆ—åŒ–ä¿®å¤**: ä¿®å¤äº†â€œä»»åŠ¡é˜Ÿåˆ—â€è·å–å¤±è´¥å¯¼è‡´é¡µé¢æŠ¥é”™çš„é—®é¢˜ã€‚ç”±äº SQLite å­˜å‚¨ç‰¹æ€§ï¼Œéƒ¨åˆ†æ—¥æœŸå­—æ®µå¯èƒ½ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜åœ¨ï¼Œå¯¼è‡´ `.isoformat()` è§¦å‘ `AttributeError`ã€‚ç°å·²å¼•å…¥ `hasattr` å®ˆæŠ¤æ ¡éªŒï¼Œç¡®ä¿æ— è®ºæ˜¯ `datetime` å¯¹è±¡è¿˜æ˜¯åŸå§‹å­—ç¬¦ä¸²éƒ½èƒ½å®‰å…¨åºåˆ—åŒ–ã€‚
    - **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘äº†ä»»åŠ¡åˆ—è¡¨æ‹‰å–æ—¶çš„é˜²å¾¡æ€§å¼€é”€ã€‚
- **å·¥ç¨‹è´¨é‡**:
    - **å›å½’æµ‹è¯•**: å»ºç«‹äº†ä¸“é—¨çš„ `test_search_records` (æ›´æ–°ç‰ˆ) å’Œ `test_get_tasks_list_handles_string_dates` éªŒè¯é€»è¾‘ï¼Œç¡®ä¿æ—¥æœŸæ ¼å¼å¤šæ ·æ€§ä¸‹çš„ç³»ç»Ÿç¨³å®šæ€§ã€‚

### ğŸš€ v1.2.5.2: è½¬å‘ä¸­å¿ƒä¸æœç´¢ç¨³å®šæ€§æå‡ (Forwarding & Analytics Stability)
- **Analytics Service æœç´¢ä¿®å¤**:
    - **AttributeError æ²»ç†**: ä¿®å¤äº† `AnalyticsService.search_records` æ–¹æ³•ä¸­ï¼Œå› ç›´æ¥è®¿é—® `RuleLog` å¯¹è±¡ä¸å­˜åœ¨çš„ `source_chat_id` å’Œ `target_chat_id` å±æ€§å¯¼è‡´çš„å´©æºƒã€‚
    - **å…³è”é¢„åŠ è½½ (joinedload)**: å¼•å…¥ `sqlalchemy.orm.joinedload` é¢„åŠ è½½å…³è”çš„ `ForwardRule` æ¨¡å‹ã€‚è¿™ä¸ä»…ä¿®å¤äº†å±æ€§è®¿é—®é—®é¢˜ï¼Œè¿˜é€šè¿‡å•æ¬¡ SQL æŸ¥è¯¢è§£å†³äº† N+1 æŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆã€‚
    - **é˜²å¾¡æ€§è®¿é—®**: åœ¨æ„é€ ç»“æœé›†æ—¶é€šè¿‡ `log.rule` å®‰å…¨è®¿é—®å­—æ®µï¼Œå¹¶å¯¹ç¼ºå¤±è§„åˆ™çš„æƒ…å†µæä¾›äº† `"æœªçŸ¥"` çš„ä¼˜é›…å›é€€ï¼Œæé«˜äº†æ•°æ®çš„å±•ç¤ºå®¹é”™æ€§ã€‚
- **è½¬å‘æ—¥å¿—æ˜¾ç¤ºä¼˜åŒ–**:
    - **æœªçŸ¥å®ä½“ä¿®å¤**: ä¿®å¤äº†ç”±äº `analytics_service` å†…éƒ¨é€»è¾‘ç¼ºé™·å¯¼è‡´çš„ Source Entity/Target Entity åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¾ç¤ºä¸º `Unknown` çš„é—®é¢˜ï¼Œç¡®ä¿äº†ç®¡ç†ç«¯æ—¥å¿—çš„å¯è¯»æ€§ã€‚
- **è´¨é‡ä¸éªŒè¯**:
    - **æ–°å¢å•æµ‹**: åœ¨ `tests/unit/services/test_analytics_service.py` ä¸­æ–°å¢äº† `test_search_records` æµ‹è¯•ï¼Œå®Œæ•´è¦†ç›–äº†æœç´¢é€»è¾‘ã€å±æ€§è®¿é—®åŠç©ºå€¼å¤„ç†è·¯å¾„ã€‚
    - **Mock å¥å£®æ€§**: ä¿®å¤äº†åŸæœ‰ `AnalyticsService` å•å…ƒæµ‹è¯•ä¸­å¯¹å¼‚æ­¥ç»„ä»¶ (`stats_repo`, `bot_client`) çš„ Mock ä¸å®Œæ•´é—®é¢˜ï¼Œæå‡äº†æœ¬åœ° CI çš„ç¨³å®šæ€§ã€‚

### ğŸš€ Web Admin React UI Integration (Web UI Refactor)
- **Frontend Architecture**:
    - **Single Page Application (SPA)**: å®Œå…¨é›†æˆäº†åŸºäº React + Vite çš„ç°ä»£åŒ–å•é¡µåº”ç”¨å‰ç«¯ï¼Œæ›¿ä»£äº†æ—§ç‰ˆåŸºäº Jinja2 æ¨¡æ¿çš„åç«¯æ¸²æŸ“é¡µé¢ã€‚
    - **Directory Standardization**: å‰ç«¯é¡¹ç›®è§„èŒƒåŒ–éƒ¨ç½²äº `web_admin/frontend`ï¼Œæ„å»ºäº§ç‰©ç»Ÿä¸€è¾“å‡ºè‡³ `dist/`ï¼Œæ¸…ç†äº† `ui/app` å’Œ `ui/static` ç­‰éè§„èŒƒç›®å½•ã€‚
- **Backend Integration**:
    - **Unified API Client**: å®ç°äº† `api-client.ts` ç»Ÿä¸€å¤„ç† API è¯·æ±‚ä¸æ‹¦æˆªå™¨ï¼Œæ”¯æŒ JWT è‡ªåŠ¨æ³¨å…¥ä¸ 401 è‡ªåŠ¨è·³è½¬ã€‚
    - **Real Authentication**: å®Œæˆäº† `/api/auth/login`, `/api/auth/me` ç­‰ API çš„å¯¹æ¥ï¼Œå®ç°äº†å‰ç«¯ä¸åç«¯çš„çœŸå®é‰´æƒé—­ç¯ï¼Œç§»é™¤äº†æ‰€æœ‰ Mock æ•°æ®ã€‚ (Task: `Workstream_Web_Real_Integration`)
    - **Dashboard Data**: ä»ªè¡¨ç›˜ (`Dashboard.tsx`) æˆåŠŸå¯¹æ¥ `/api/system/stats` å’Œ `/api/system/resources`ï¼Œå®æ—¶å±•ç¤ºçœŸå®çš„ CPU/å†…å­˜/ç£ç›˜åŠä¸šåŠ¡ç»Ÿè®¡æ•°æ®ã€‚
- **Build System**:
    - **Production Ready**: ä¼˜åŒ–äº†æ„å»ºè„šæœ¬ï¼Œæ¯æ¬¡å‘å¸ƒè‡ªåŠ¨æ¸…ç†æ—§ç‰ˆæœ¬ç¼“å­˜æ–‡ä»¶ï¼Œç¡®ä¿ `dist/` ç›®å½•æ¸…æ´ã€‚

## ğŸ“… 2026-02-13 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.5.1: æ›´æ–°è‡ªæ„ˆä¸å¥åº·æ£€æŸ¥ç¨³å®šæ€§ä¼˜åŒ– (Update Resilience & Health Check Fix)
- **UpdateService æ•…éšœè‡ªæ„ˆä¿®å¤**:
    - **é€»è¾‘å†—ä½™æ¶ˆé™¤**: ç§»é™¤äº† `UpdateService.start_periodic_check` ä¸­å¯¹ `verify_update_health` çš„äºŒæ¬¡è°ƒç”¨ï¼Œç¡®ä¿ä»…åœ¨åº”ç”¨å¯åŠ¨åˆæœŸ (`main.py`) æ‰§è¡Œå•æ¬¡è‡ªæ£€ã€‚è¿™è§£å†³äº†åœ¨æ›´æ–°åâ€œè§‚å¯ŸæœŸâ€å†…æ¯ä¸€è½®è¿›ç¨‹å¯åŠ¨åŒå€å¢åŠ å¤±è´¥è®¡æ•°å™¨çš„ Bugã€‚
    - **è¿›ç¨‹çº§é˜²æŠ– (Health Check Debounce)**: å¼•å…¥äº† `_health_checked_in_this_process` çŠ¶æ€é”ã€‚åˆ©ç”¨ Python å¯¹è±¡çš„è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œæœ‰æ•ˆé˜²æ­¢å› é€»è¾‘é‡å…¥å¯¼è‡´çš„ `fail_count` è¯¯æŠ¥ç´¯åŠ ï¼Œæå‡äº†å›æ»šåˆ¤å®šçš„ç²¾ç¡®åº¦ã€‚
- **ç³»ç»Ÿå…³é—­ç¨³å®šæ€§ (Shutdown Stability)**:
    - **EventBus å…¼å®¹æ€§è¡¥ä¸**: ä¸º `EventBus` æ˜¾å¼å¢åŠ äº† `emit` æ–¹æ³•ä½œä¸º `publish` çš„åˆ«åã€‚è¿™è§£å†³äº†åœ¨ç³»ç»Ÿæ›´æ–°æˆ–å…³é—­æ—¶ï¼Œéƒ¨åˆ†æ—§è¿›ç¨‹æˆ–åŠ¨æ€è°ƒç”¨å› æ¥å£ä¸ä¸€è‡´å¯¼è‡´çš„ `'EventBus' object has no attribute 'emit'` æŠ¥é”™ï¼Œç¡®ä¿ä¼˜é›…å…³é—­æµç¨‹ 100% æˆåŠŸã€‚
    - **Bootstrap è·¯å¾„ä¼˜åŒ–**: å†æ¬¡æ ¸å®å¹¶é”å®šäº† `core/bootstrap.py` ä¸­çš„äº‹ä»¶å‘å¸ƒè¯­ä¹‰ï¼Œç¡®ä¿å…¶ç¬¦åˆæœ€æ–°çš„ `EventBus` åè®®ã€‚
- **çƒ­é‡å¯å†²çªæŠ‘åˆ¶ (Guard Guard)**:
    - **å†²çªæ²»ç†**: ä¿®å¤äº†ç”±äº `.env` ç­‰å…³é”®æ–‡ä»¶æ›´æ–°è§¦å‘ `GuardService` é‡å¯ï¼Œè¿›è€Œå¹²æ‰° `UpdateService` å¥åº·è§‚å¯ŸæœŸçš„æ­»å¾ªç¯ã€‚
    - **è§‚å¯ŸæœŸä¿æŠ¤**: åœ¨ç³»ç»Ÿå¯åŠ¨åçš„ 60 ç§’ç¨³å®šæ€§éªŒè¯æœŸå†…ï¼Œ`GuardService` è‡ªåŠ¨æŠ‘åˆ¶ä»»ä½•æ–‡ä»¶å˜æ›´å¼•å‘çš„çƒ­é‡å¯æ“ä½œï¼Œä¿éšœäº†ç³»ç»Ÿæ›´æ–°åçš„å¹³ç¨³è¿‡æ¸¡ä¸æ•°æ®åº“è¿ç§»ä»»åŠ¡çš„åŸå­æ€§ã€‚
- **ä»»åŠ¡é˜Ÿåˆ—ååé‡ä¼˜åŒ–ä¸å¤±è´¥æ²»ç† (Queue Performance Fix)**:
    - **æ‰©å®¹æœºåˆ¶ä¿®å¤**: ä¿®æ­£äº† `WorkerService` ä¸­ç”±äºç»Ÿè®¡é”®åä¸åŒ¹é… (`pending` vs `active_queues`) å¯¼è‡´çš„åŠ¨æ€æ‰©å®¹å¤±æ•ˆé—®é¢˜ï¼Œæ¢å¤äº†ç³»ç»Ÿæ ¹æ®ç§¯å‹é‡è‡ªåŠ¨è°ƒèŠ‚å¹¶å‘çš„èƒ½åŠ›ã€‚
    - **æ‰¹é‡è·å– (Batch Fetching)**: é‡æ„äº† `task_repo.fetch_next` å’Œ `WorkerService` å¾ªç¯ï¼Œæ”¯æŒåŸå­åŒ–æ‰¹é‡æ‹‰å–å¹¶é”å®šä»»åŠ¡ï¼Œæ˜¾è‘—é™ä½äº†é«˜ç§¯å‹åœºæ™¯ä¸‹çš„æ•°æ®åº“é”ç«äº‰ã€‚
    - **å·¥ç¨‹å¤‡æ¡ˆ**: å¯åŠ¨äº†ä»»åŠ¡ `20260213_Task_Queue_Optimization` è¿›è¡Œç§¯å‹æ¸…ç†ä¸æ€§èƒ½è°ƒä¼˜ã€‚
- **è´¨é‡ä¸ç‰ˆæœ¬**:
    - **ç‰ˆæœ¬åŒæ­¥**: å½“å‰ä¿æŒ v1.2.5.1ã€‚
    - **å·¥ç¨‹å¤‡æ¡ˆ**: å®Œæˆäº†ä»»åŠ¡ `20260213_Fix_Update_Restart_Loop` çš„æŠ€æœ¯æŠ¥å‘Šä¸é—­ç¯è®°å½•ã€‚


## ğŸ“… 2026-02-11 æ›´æ–°æ‘˜è¦

### ğŸš€ Bugfix: ViewResult NameError & UI å…¼å®¹æ€§åŠ å›º (UI Compatibility & NameError Fix)
- **UI æ¸²æŸ“å™¨ä¿®å¤**:
    - **NameError æ²»ç†**: è¡¥å…¨äº† `MainMenuRenderer`, `TaskRenderer`, `SettingsRenderer` ä¸­ç¼ºå¤±çš„ `ViewResult` å’Œ `UIStatus` å¯¼å…¥ï¼Œè§£å†³äº† `/settings` æŒ‡ä»¤è§¦å‘æ—¶çš„å´©æºƒé—®é¢˜ã€‚
    - **é˜²å¾¡æ€§æ¸²æŸ“**: åœ¨ `MainMenuRenderer.render` ä¸­å¢åŠ äº†å¯¹ `None` ç»Ÿè®¡æ•°æ®çš„ä¼˜é›…å¤„ç†ï¼Œé¿å…å› æœåŠ¡ä¸å¯ç”¨å¯¼è‡´çš„æ¸²æŸ“æº¢å‡ºã€‚
- **å…¼å®¹æ€§å±‚å¢å¼º (Hotfix)**:
    - **ViewResult åè®®æ‰“æ¡©**: ä¸º `ViewResult` å®¹å™¨å®ç°äº† `__getitem__` å’Œ `__contains__` æ–¹æ³•ã€‚è¿™ä¸€æ”¹åŠ¨å…è®¸æ—§ç‰ˆ Controller ç»§ç»­ä½¿ç”¨å­—å…¸é£æ ¼ (å¦‚ `result['text']`) è®¿é—®æ–°ç‰ˆæ¸²æŸ“å¯¹è±¡ï¼Œæå¤§é™ä½äº†é‡æ„é£é™©ã€‚
    - **ç±»å‹å®‰å…¨**: ä¿®å¤äº† `ViewResult` åœ¨å¤„ç†éå­—ç¬¦ä¸² Key æˆ–ä½¿ç”¨ `in` æ“ä½œç¬¦æ—¶å¯èƒ½è§¦å‘çš„ `TypeError`ã€‚
- **UI è§„èŒƒå¯¹é½ (UIRE-2.0)**:
    - **æµ‹è¯•ä¿®æ­£**: æ›´æ–°äº† `tests/unit/ui/renderers/test_main_menu_renderer.py` ä¸­çš„è¿‡æ—¶æ–­è¨€ï¼Œé€‚é…äº† 2.0 ç‰ˆæ¸²æŸ“å¼•æ“çš„ä¸­æ–‡æ ‡ç‚¹è¾“å‡ºã€‚
    - **é”™è¯¯å¸ƒå±€ä¼˜åŒ–**: å¢å¼ºäº† `BaseRenderer.render_error`ï¼Œç¡®ä¿åœ¨æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯æ—¶ä¸ä¼šè¦†ç›–åŸºç¡€æç¤ºä¿¡æ¯ã€‚
    - **æ›´æ–°æŒ‡ä»¤ UI ä¼˜åŒ–**: é‡æ–°è®¾è®¡äº† `/update` æŒ‡ä»¤çš„ç¡®è®¤ç•Œé¢ï¼Œæ–°å¢è¿œç¨‹ä¸æœ¬åœ° SHA æŒ‡çº¹å¯¹æ¯”æ˜¾ç¤ºï¼Œå¹¶é‡‡ç”¨æ ‡å‡†å…¨è§’æ ‡ç‚¹æ ·å¼ã€‚
- **è´¨é‡é—¨ç¦ä¸éªŒè¯**:
    - **å…¨é“¾è·¯ Mock éªŒè¯**: é€šè¿‡ `test_settings_trigger.py` æˆåŠŸæ¨¡æ‹Ÿäº†ä»æŒ‡ä»¤è§¦å‘åˆ° UI ç”Ÿæˆçš„å®Œæ•´äº¤äº’é“¾è·¯ã€‚
    - **ä»£ç è´¨é‡é€šå…³**: ä¿®å¤äº†å…¨ç³»ç»Ÿ 10+ å¤„ç”±æ¶æ„å·¡æ£€å‘ç°çš„ `F821` (æœªå®šä¹‰å˜é‡) é”™è¯¯ï¼Œå®ç°äº†æ ¸å¿ƒè·¯å¾„çš„ Flake8 é€šå…³ã€‚


## ğŸ“… 2026-02-09 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.5.0: UIRE-2.0 æ¸²æŸ“å¼•æ“ä¸ CVM æ¶æ„æ¨¡å—åŒ– (UIRE-2.0 & CVM Modularization)
- **UIRE-2.0 Rendering Engine**:
    - **Smart Layout Engine**: é‡æ„ `MenuBuilder` æ”¯æŒåŸå­è¡Œæ§åˆ¶ (`add_button_row`) ä¸æ™ºèƒ½è‡ªé€‚åº”å¸ƒå±€ (`_apply_smart_layout`)ã€‚æ ¹æ®æ ‡ç­¾é•¿åº¦è‡ªåŠ¨åˆ‡æ¢ [1 | 2 | 3] åˆ—æ’ç‰ˆã€‚
    - **Robustness Infrastructure**: å¼•å…¥ `TextUtil` å·¥å…·é›†ã€‚å®ç°é¦–å°¾ç¼©ç•¥ (`smart_truncate`) ä»¥ä¿æŠ¤é•¿ ID å¸ƒå±€ï¼Œå¹¶æä¾› Markdown å®‰å…¨é€ƒé€¸æ”¯æŒã€‚
    - **Global Safeguards**: æ–°å¢ `3800` å­—ç¬¦ç¡¬æ€§ç†”æ–­é™çº§æœºåˆ¶ï¼Œç¡®ä¿ç”Ÿæˆçš„å“åº”æ–‡æœ¬å§‹ç»ˆç¬¦åˆ Telegram åè®®çš„ 4096 å­—ç¬¦ä¸Šé™ï¼Œå½»åº•æœç»æ¸²æŸ“æº¢å‡ºå¯¼è‡´çš„ 400 é”™è¯¯ã€‚
    - **Sticky Buttons**: å®ç°æ™ºèƒ½åº•æ å¸é™„æœºåˆ¶ï¼Œå°†â€œè¿”å›â€ã€â€œé€€å‡ºâ€ã€â€œå–æ¶ˆâ€ç­‰æ“ä½œè‡ªåŠ¨å½’å¹¶åœ¨èœå•åº•éƒ¨å¹¶åŒåˆ—æ’ç‰ˆã€‚
- **CVM Architecture (Controller-View-Modularization)**:
    - **Separation of Concerns**: æˆåŠŸå°† `RuleRenderer`, `MediaRenderer`, `TaskRenderer` ç­‰è§†å›¾é€»è¾‘ä»å›è°ƒå¤„ç†å™¨ä¸­å‰¥ç¦»ã€‚æ§åˆ¶å™¨ç°åœ¨ä»…è´Ÿè´£æ•°æ®è°ƒåº¦ï¼Œæ¸²æŸ“å™¨è´Ÿè´£è§†è§‰è¡¨è¾¾ã€‚
    - **Renderer Purity**: æ¸²æŸ“å™¨ç°åœ¨é€šè¿‡ `ViewResult` åè®®è¿”å›è§†å›¾å…ƒæ•°æ®ï¼Œæå‡äº† UI ä»£ç çš„å¯æµ‹è¯•æ€§ä¸æ­£äº¤åŒ–ç¨‹åº¦ã€‚
    - **Visual Standardization**: ç»Ÿä¸€äº†å…¨ç³»ç»Ÿçš„é¢åŒ…å±‘ (`Breadcrumb`) å¯¼èˆªè·¯å¾„ï¼ˆæ ¹èŠ‚ç‚¹ï¼šé¦–é¡µï¼‰ã€‚åœ¨ `UIStatus` ä¸­è§„èŒƒäº† 30+ ç§çŠ¶æ€å›¾æ ‡ã€‚
- **Documentation & Verification**:
    - **Developer Experience**: ç¼–å†™äº†ã€ŠUI å¼€å‘å‚è€ƒæ‰‹å†Œã€‹(`UI_GUIDE.md`)ï¼Œä¸ºåç»­åŠŸèƒ½çš„ UI å¼€å‘æä¾›äº†ç»Ÿä¸€çš„ä»£ç ç‰‡æ®µä¸è§„èŒƒæŒ‡å¼•ã€‚
    - **Full-Link Integration**: æ–°å¢é›†æˆæµ‹è¯• `tests/integration/test_uire_v2_full_link.py`ï¼Œå®Œæ•´è¦†ç›–äº†ä»æ§åˆ¶å™¨åˆ°æ¸²æŸ“å™¨çš„äº¤äº’é“¾è·¯ã€‚

 
## ğŸ“… 2026-02-08 æ›´æ–°æ‘˜è¦
 
### ğŸš€ v1.2.4.5: QoS 4.0 åŠ¨æ€æ³³é“è·¯ç”± (QoS 4.0: Dynamic Lane Routing)
- **Core Queue Intelligence**:
    - **Multi-Lane Isolation**: å½»åº•åºŸå¼ƒå•ä¸€ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œé‡æ„ä¸º `Critical` (ğŸš‘ ç´§æ€¥), `Fast` (ğŸï¸ å¿«é€Ÿ), `Standard` (ğŸš— æ ‡å‡†) ä¸‰æ¡ç‰©ç†éš”ç¦»çš„å¼‚æ­¥é˜Ÿåˆ—ã€‚
    - **CAP Algorithm (Chinese Edition)**: å®ç°äº†å…¨æ±‰åŒ–çš„æ‹¥å¡æ„ŸçŸ¥è·¯ç”±ç®—æ³•ã€‚æ ¹æ® `Score = Base - (Pending * 0.5)` åŠ¨æ€è®¡ç®—æ¶ˆæ¯è¯„åˆ†ã€‚
    - **Traffic Shaping**: è‡ªåŠ¨è¯†åˆ«åˆ·å±ç¾¤ç»„å¹¶å°†å…¶åç»­æµé‡æ— æ„Ÿé™çº§è‡³æ ‡å‡†æ³³é“ï¼Œç¡®ä¿ VIP ç”¨æˆ·å’Œå…¶ä»–ç¾¤ç»„ä¸å—â€œé‚»å±…å¹²æ‰°â€ã€‚
- **Observability & UX**:
    - **Localized Metrics**: æ—¥å¿—ç³»ç»Ÿå…¨é¢æ±‰åŒ–ï¼Œå®æ—¶è¾“å‡ºæ¶ˆæ¯çš„â€œæœ‰æ•ˆè¯„åˆ†â€ã€â€œæ‰€å±æ³³é“â€åŠâ€œç§¯å‹æƒé‡â€ï¼Œæå¤§æå‡äº†é«˜è´Ÿè½½ä¸‹çš„è¿ç»´é€æ˜åº¦ã€‚
    - **Command Alignment**: æ›´æ–° `/vip` (æˆ– `/set_priority`) å’Œ `/queue_status` æŒ‡ä»¤ï¼Œä½¿ç”¨æ³³é“æ ‡è¯†ï¼ˆğŸš‘ ğŸï¸ ğŸš—ï¼‰æ›¿æ¢è¿‡æ—¶çš„æ•°å­—æè¿°ï¼Œè¯­ä¹‰æ›´æ¸…æ™°ã€‚
- **Verification**:
    - é€šè¿‡ `tests/test_qos_v4.py` å®Œæˆäº†å¹¶å‘éš”ç¦»ä¸æŠ¢å è°ƒåº¦æ¨¡æ‹ŸéªŒè¯ã€‚

### ğŸš€ v1.2.4.4: æ„å»ºç³»ç»Ÿå‡çº§ä¸æ ¸å¿ƒ Bug ä¿®å¤ (Build System Upgrade & Core Fixes)
- **Build System & Infrastructure**:
    - **uv Integration**: å°†é¡¹ç›®ä¾èµ–ç®¡ç†ä» `pip` å…¨é¢è¿ç§»è‡³ `uv`ï¼Œåœ¨ `Dockerfile` å’Œ `UpdateService` ä¸­åˆ©ç”¨å…¶å¤šçº¿ç¨‹å¹¶è¡Œå®‰è£…ç‰¹æ€§ï¼Œå°†æ„å»ºä¸ä¾èµ–æ›´æ–°é€Ÿåº¦æå‡çº¦ 5 å€ã€‚
    - **Docker Optimization**: ä¼˜åŒ– `Dockerfile` åˆ†å±‚ï¼Œå¼•å…¥ `uv` ç¼“å­˜æŒ‚è½½æœºåˆ¶ (`--mount=type=cache`)ï¼Œå¹¶ç¾åŒ–äº†æ„å»ºè¿‡ç¨‹ä¸­çš„çŠ¶æ€è¾“å‡ºè¾“å‡ºç•Œé¢ã€‚
- **Core Bug Fixes**:
    - **MessageContext Stability**: ä¿®å¤äº† `SenderFilter` åœ¨éªŒè¯ç›®æ ‡èŠå¤©æ—¶å›  `MessageContext` ç¼ºå¤± `metadata` å±æ€§å¯¼è‡´çš„ `AttributeError` å´©æºƒã€‚é€šè¿‡åœ¨ `__slots__` ä¸­æ­£äº¤åŒ–è¯¥å­—æ®µï¼Œä¿éšœäº†è·¨ä¸­é—´ä»¶æ•°æ®çš„å®‰å…¨æµè½¬ã€‚
    - **Startup Resilience**: è§£å†³äº†ç”±äº Bot å‘½ä»¤ï¼ˆå¦‚ `/rollback` / `/upgrade`ï¼‰å¯¼å…¥é€»è¾‘å¯¼è‡´çš„å¯åŠ¨å´©æºƒï¼Œå¢å¼ºäº† `bot_handler.py` çš„å®¹é”™æ€§ã€‚
    - **Graceful Shutdown**: ä¿®æ­£äº† `ShutdownCoordinator` é‡å¤è°ƒç”¨å¼•å‘çš„è­¦å‘Šï¼Œå¹¶å®Œå–„äº†è‡ªåŠ¨æ›´æ–°åä¾èµ–æ ¡éªŒæ—¥å¿—çš„å¯è§æ€§ã€‚
- **Performance & Experience**:
    - **Priority Queue**: å®ç°å¤šçº§ä¼˜å…ˆçº§é˜Ÿåˆ— (P0-P3)ï¼Œä¼˜å…ˆä¿éšœå³æ—¶è½¬å‘ä»»åŠ¡å¤„ç†ï¼Œæœ‰æ•ˆç¼“è§£é«˜é¢‘è´Ÿè½½ä¸‹çš„æ¶ˆæ¯ç§¯å‹ä¸å»¶è¿Ÿã€‚
    - **Documentation**: å®Œæˆäº† `20260208_FixSenderFilterMetadata` ç­‰ 5+ ä¸ªä»»åŠ¡çš„æŠ€æœ¯æŠ¥å‘Šã€Todo åŒæ­¥åŠé—­ç¯å½’æ¡£ã€‚

### ğŸš€ v1.2.4.3: å·¥ä¸šçº§æ›´æ–°äº¤äº’ä¸æ•…éšœè‡ªæ„ˆ (Advanced Update & Rollback Interface)
- **Infrastructure & Reliability**:
    - **Uptime Guard**: åœ¨ `entrypoint.sh` ä¸­å¼•å…¥â€œå¯åŠ¨å®ˆæŠ¤ç»¿æ´²â€ï¼Œå®ç°åœ¨æ›´æ–°å 15 ç§’å†…å‘ç”Ÿå´©æºƒæ—¶è‡ªåŠ¨æ‰§è¡Œå›æ»šï¼Œå½»åº•ç»ˆç»“â€œåç‰ˆæœ¬å¯¼è‡´æ­»å¾ªç¯â€çš„è¿ç»´éšæ‚£ã€‚
    - **State Verification**: å¼•å…¥ `UPDATE_VERIFYING.json` ä¸­é—´æ€é”ï¼Œä½¿ç³»ç»Ÿåœ¨â€œè§‚å¯ŸæœŸâ€å†…ä»èƒ½è¯†åˆ«æ½œåœ¨æ•…éšœå¹¶è§¦å‘å®‰å…¨é™çº§ã€‚
    - **Physical Failover**: å¢å¼ºç‰©ç†å¤‡ä»½é€»è¾‘ï¼Œåœ¨ Git å›æ»šå—é˜»æ—¶ï¼ˆå¦‚ä»“åº“æŸåï¼‰ï¼Œè‡ªåŠ¨é€šè¿‡ `.tar.gz` åŸå§‹ä»£ç åŒ…è¿˜åŸæ ¸å¿ƒç›®å½•ã€‚
- **Interactive Interfaces (Maximum Reuse)**:
    - **Python CLI**: æ–°å¢ `scripts/ops/manage_update.py`ï¼Œæ”¯æŒç»ˆç«¯æŸ¥çœ‹çŠ¶æ€ (`status`)ã€è¡¥ä¸/å…¨é‡æ›´æ–° (`upgrade`) å’Œç´§æ€¥æ•‘æ€¥ (`rollback`)ã€‚
    - **Bot Management**: åœ¨ `/update` å’Œ `/rollback` æŒ‡ä»¤ä¸­é›†æˆäºŒæ¬¡ç¡®è®¤é€»è¾‘ä¸ç›®æ ‡ç‰ˆæœ¬é€‰æ‹©ï¼Œæ”¯æŒç²¾ç¡®å›æ»šè‡³å†å²ç‰ˆæœ¬ (`/history` è·³è½¬)ã€‚
    - **Architecture Consistency**: é‡æ„ `UpdateService` å°†åŸæœ¬åˆ†æ•£åœ¨ CLI å’Œ Bot çš„æ›´æ–°é€»è¾‘æ”¶å£ä¸ºç»Ÿä¸€çš„å¼‚æ­¥çŠ¶æ€æœºæŒ‡ä»¤ï¼Œç¡®ä¿æ“ä½œå¹‚ç­‰ä¸çŠ¶æ€åŒæ­¥ã€‚

## ğŸ“… 2026-02-08 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.4.2: ä¿®å¤ Bot å‘½ä»¤èœå•ä¹±ç  (Fix Bot Command Encoding)
- **Critical Encoding Fix**:
    - **Double-Encoding Recovery**: æ·±åº¦åˆ†æå¹¶ä¿®å¤äº† `handlers/bot_commands_list.py` ä¸­çš„ä¸¥é‡ä¹±ç é—®é¢˜ï¼ˆUTF-8 -> GBK -> UTF-8 åŒé‡ç¼–ç ç ´åï¼‰ï¼Œæ¢å¤äº†æ‰€æœ‰ Bot Command çš„ä¸­æ–‡æè¿°ä¸ Emojiã€‚
    - **Recovery Script**: å¼€å‘å¹¶æ‰§è¡Œäº†ä¸“ç”¨çš„é€†å‘ä¿®å¤è„šæœ¬ï¼ŒæˆåŠŸè¿˜åŸäº† 90+ è¡Œå—æŸä»£ç ã€‚
    - **Verification**: é€šè¿‡ `syntax_check.py` éªŒè¯äº†ä¿®å¤åæ–‡ä»¶çš„ Python è¯­æ³•å®Œæ•´æ€§ï¼Œå¹¶ç§»é™¤äº†å¯èƒ½å¯¼è‡´ç¼–è¯‘é—®é¢˜çš„ UTF-8 BOM å¤´ã€‚

### ğŸš€ v1.2.4.1: è¿ç»´å«ç”Ÿä¸å…³é—­æµç¨‹ä¼˜åŒ– (DevOps & Shutdown Optimization)
- **DevOps & Logging**:
    - **Visible Dependency Check**: å¢å¼ºäº† `entrypoint.sh` çš„å®ˆæŠ¤è¿›ç¨‹æ—¥å¿—ï¼Œåœ¨æ ¡éªŒä¾èµ–æ—¶å¢åŠ  `ğŸ”æ ¡éªŒä¸­...` å’Œ `âœ…æ ¡éªŒé€šè¿‡` çš„æ˜ç¡®è¾“å‡ºï¼Œæ¶ˆé™¤é‡å¯æ—¶çš„â€œé»‘ç›’â€çŠ¶æ€ã€‚
    - **Shutdown Idempotency**: ä¼˜åŒ–äº† `ShutdownCoordinator` å’Œ `LifecycleManager` çš„åä½œé€»è¾‘ï¼Œé€šè¿‡çŠ¶æ€é¢„æ£€å®ç°å…³é—­æµç¨‹çš„å¹‚ç­‰æ€§ã€‚
    - **Log Noise Reduction**: å°†é‡å¤è§¦å‘å…³é—­æµç¨‹æ—¶çš„è­¦å‘Šçº§åˆ«ä» `WARNING` é™çº§ä¸º `INFO`ï¼Œè§£å†³äº†å¤šè§¦å‘æºå¯¼è‡´çš„å™ªéŸ³è­¦å‘Šã€‚
- **Arch Integrity**:
    - **Redunancy Removal**: ç§»é™¤äº† `main.py` å¯åŠ¨å¼‚å¸¸å—ä¸­å†—ä½™çš„ `lifecycle.stop()` è°ƒç”¨ï¼Œç³»ç»Ÿç°ç”± `lifecycle.start()` å†…éƒ¨é—­ç¯å¤„ç†ä¸¥é‡å¼‚å¸¸ã€‚
- **Engineering Hygiene**:
    - **Automated Archiving**: ä½¿ç”¨ `docs-archiver` æŠ€èƒ½å®Œæˆäº† 10+ ä¸ªå·²ç»“ç®—ä»»åŠ¡ï¼ˆå¦‚ `20260207_FixGreenletError_History` ç­‰ï¼‰çš„å½’æ¡£æ¸…ç†ã€‚
    - **Tree Sync**: åŒæ­¥æ›´æ–° `docs/tree.md` ç´¢å¼•ï¼Œç¡®ä¿ç‰©ç†æ–‡ä»¶ä¸ç›®å½•æ–‡æ¡£ä¸€è‡´ã€‚
    - **Cleanup**: æ¸…ç†äº†è°ƒè¯•ç”¨çš„ä¸´æ—¶è„šæœ¬ `tests/reproduce_double_shutdown.py`ã€‚

### ğŸš€ v1.2.4.0: å»é‡å¼•æ“å¥å£®æ€§ä¸å†²çªä¿®å¤ (Dedup Engine Robustness & Fixes)
- **Core Fixes**:
    - **Method Alignment**: ä¿®å¤äº† `DedupRepository` ä¸­ `batch_add_media_signatures` çš„ `AttributeError` å‘½åä¸ä¸€è‡´é—®é¢˜ã€‚
    - **Logic De-conflict**: ç§»é™¤äº† `KeywordFilter` ä¸­å†—ä½™çš„å»é‡æ ¡éªŒï¼Œè§£å†³äº†ä¸ `DedupMiddleware` åŒé‡é”å®šå¯¼è‡´çš„â€œå…¨å‘˜è¯¯åˆ¤ä¸ºé‡å¤â€å…³é”® Bugã€‚
    - **Reliability Improvement**: å®ç°åˆ·å†™ç¼“å†²åŒºå¤±è´¥æ—¶çš„**è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ (Re-queueing)** æœºåˆ¶ï¼Œç¡®ä¿é«˜è´Ÿè½½ä¸‹çš„æ•°æ®å®Œæ•´æ€§ã€‚
    - **Safe Filtering**: åœ¨ä»“åº“å±‚å¼•å…¥å­—æ®µè¿‡æ»¤ï¼Œé˜²æ­¢ `bulk_insert_mappings` å› æ¨¡å‹å†—ä½™å­—æ®µå¯¼è‡´çš„è¿è¡Œæ—¶å¼‚å¸¸ã€‚
- **Stability**:
    - **Similarity Guard**: ä¿®å¤äº† `SimilarityStrategy` ä¸­ `comparisons` å˜é‡æœªå®šä¹‰çš„ `NameError`ã€‚
    - **History Skip**: åœ¨ `DedupMiddleware` ä¸­å¢åŠ å¯¹ `is_history` ä»»åŠ¡çš„è‡ªåŠ¨è·³è¿‡ï¼Œä¿éšœäº†å†å²è¡¥å…¨æµç¨‹çš„è¿è´¯æ€§ã€‚
- **Verification**:
    - æ–°å¢ `tests/unit/repositories/test_dedup_repo_batch.py` éªŒè¯æ‰¹é‡å†™å…¥å¥å£®æ€§ã€‚


### ğŸš€ v1.2.3.9: æ•°æ®åº“ç›‘æ§ä¸é«˜çº§å»é‡ (Database Monitoring & Advanced Dedup)
- **Database Monitoring System**:
    - **Performance Dashboard**: å®ç° `db_performance_monitor` é¢æ¿ï¼Œå®æ—¶å±•ç¤º QPSã€æ…¢æŸ¥è¯¢åˆ†æ (Slow Query Analysis) å’Œçƒ­ç‚¹è¡¨ç»Ÿè®¡ã€‚
    - **Optimization Center**: é›†æˆ `db_optimization_center`ï¼Œæä¾›åŸºäºè§„åˆ™çš„è‡ªåŠ¨è¯Šæ–­å»ºè®® (Anomaly Detection Recommendations) å’Œä¸€é”®ä¼˜åŒ–åŠŸèƒ½ (VACUUM/REINDEX)ã€‚
    - **Visual Trends**: å¼•å…¥ ASCII å­—ç¬¦ç”»è¶‹åŠ¿å›¾ (`render_db_performance_trends`)ï¼Œç›´è§‚å‘ˆç°è¿‘ 7 å¤©çš„æ•°æ®åº“å†™å…¥è´Ÿè½½å˜åŒ–ã€‚
- **Advanced Deduplication Settings**:
    - **Per-Rule Configuration**: å®ç°è§„åˆ™çº§å»é‡ç­–ç•¥è¦†ç›– (Rule-Level Override)ï¼Œå…è®¸é’ˆå¯¹ç‰¹å®šè½¬å‘è§„åˆ™å•ç‹¬é…ç½®â€œæ™ºèƒ½ç›¸ä¼¼åº¦é˜ˆå€¼â€å’Œâ€œè‡ªå®šä¹‰æ—¶é—´çª—å£â€ã€‚
    - **UI Integration**: åœ¨è§„åˆ™è¯¦æƒ…é¡µé›†æˆ `dedup_settings` å…¥å£ï¼Œæ”¯æŒå¯è§†åŒ–åˆ‡æ¢å…¨å±€/è‡ªå®šä¹‰é…ç½®æ¨¡å¼ã€‚
- **Infrastructure**:
    - **Service Integration**: å°† `DBMaintenanceService` æ·±åº¦é›†æˆè‡³èœå•ç³»ç»Ÿï¼Œå®ç°ä» UI ç›´æ¥è§¦å‘åç«¯ç»´æŠ¤ä»»åŠ¡ã€‚
    - **Cache Management**: æ–°å¢å»é‡ç¼“å­˜ (L1/L2) çš„å®æ—¶ç›‘æ§ä¸æ‰‹åŠ¨æ¸…ç†åŠŸèƒ½ã€‚


### ğŸš€ v1.2.3.8: å»é‡å¼•æ“ V3 å‡çº§ (Dedup Engine V3)
- **Core Algorithms**:
    - **Numba JIT**: é›†æˆ Numba å¯¹æ±‰æ˜è·ç¦»è®¡ç®—è¿›è¡Œä½è¿ç®—ä¼˜åŒ–ï¼Œåœ¨é«˜ç»´å‘é‡æ¯”å¯¹åœºæ™¯ä¸‹æ€§èƒ½æå‡è¶…è¿‡ 10 å€ã€‚
    - **LSH Forest**: å¼•å…¥å±€éƒ¨æ•æ„Ÿå“ˆå¸Œæ£®æ— (Locality Sensitive Hashing Forest)ï¼Œå®ç°æµ·é‡æ–‡æœ¬è¯­ä¹‰æŒ‡çº¹çš„è¿‘ä¼¼æ£€ç´¢ï¼Œæ¯”å¯¹å¤æ‚åº¦ä» $O(N)$ ä¼˜åŒ–è‡³ $O(\log N)$ã€‚
    - **SSH v5**: å®ç° Sparse Sentinel Hash v5 è§†é¢‘é‡‡æ ·ç®—æ³•ï¼Œæ”¯æŒå¯¹è¶…å¤§è§†é¢‘è¿›è¡Œç§’çº§å¤šç‚¹ç‰¹å¾æå–ï¼Œæ˜¾è‘—å¢å¼ºäº†å¯¹å‰ªè¾‘/æ··å‰ªè§†é¢‘çš„è¯†åˆ«èƒ½åŠ›ã€‚
- **Architecture Refactoring**:
    - **Strategic Pattern**: å°†å»é‡é€»è¾‘å½»åº•è§£è€¦ä¸º `Signature`, `Video`, `Content`, `Similarity` å››å¤§ç‹¬ç«‹ç­–ç•¥ï¼Œæ”¯æŒæŒ‰éœ€çƒ­æ’æ‹”ã€‚
    - **SmartDeduplicator Facade**: é€šè¿‡å¤–è§‚æ¨¡å¼ç»Ÿä¸€å¤–éƒ¨é“¾è·¯ï¼Œå±è”½å†…éƒ¨å¤æ‚çš„ç­–ç•¥è°ƒåº¦ä¸ LSH ç´¢å¼•ç®¡ç†ã€‚
- **Infrastructure & Maintenance**:
    - **Tombstone State Management**: å®ç°å¼•æ“çŠ¶æ€çš„â€œå¢“ç¢‘â€ä¼‘çœ ä¸å¤è‹æœºåˆ¶ï¼Œåœ¨ä½è´Ÿè½½æ—¶å¯å†»ç»“å†…å­˜ç´¢å¼•å¹¶å½’è¿˜ç‰©ç†å†…å­˜ï¼Œå“åº”æ—¶é€æ˜æ¢å¤ã€‚
    - **Batched Persistence**: å¼•å…¥æ‰¹å¤„ç†ç¼“å†²åŒº (Batched Buffer) ä¸æŒä¹…åŒ–ç¼“å­˜ (PCache)ï¼Œå¹³è¡¡äº†å®æ—¶å»é‡ä¸æ•°æ®åº“å…¥åº“å‹åŠ›ã€‚
- **Verification**:
    - å…¨é¢é€šè¿‡ `tests/unit/services/test_dedup_service.py` å•å…ƒæµ‹è¯•ã€‚
    - å·²åŒæ­¥æ›´æ–° `version.py` ä¿¡æ¯ã€‚


### ğŸš€ v1.2.3.7: æµé‡ç»Ÿè®¡ä¸æ–‡æ¡£å¢å¼º (Traffic Stats & Docs)
- **New Feature (Intercepted Traffic)**: 
    - **Smart Deduplicator**: åœ¨æ ¸å¿ƒå»é‡å¼•æ“ `SmartDeduplicator` ä¸­é›†æˆâ€œæ‹¦æˆªæµé‡â€è®¡æ•°å™¨ï¼Œå®ç°å­—èŠ‚çº§ç»Ÿè®¡ (Byte-level Accounting)ã€‚
    - **DB Schema**: `ChatStatistics` æ¨¡å‹æ–°å¢ `saved_traffic_bytes` å­—æ®µï¼Œå¹¶é€šè¿‡ Migration è‡ªåŠ¨åŒæ­¥æ•°æ®åº“ç»“æ„ã€‚
    - **UI Enhancement**: ä¸»èœå• (Main Menu) æ–°å¢â€œğŸ›¡ï¸ æ‹¦æˆªæµé‡â€å±•ç¤ºï¼Œä¸â€œğŸ’¾ æ¶ˆè€—æµé‡â€å½¢æˆå¯¹æ¯”ï¼Œç›´è§‚å‘ˆç°å»é‡æ”¶ç›Šã€‚
- **Documentation System**:
    - **FAQ Integration**: å®ç° `MenuController.show_faq`ï¼Œæä¾›å…³äºè§„åˆ™ç®¡ç†ã€å»é‡å¤±æ•ˆã€å»¶è¿Ÿç­‰å¸¸è§é—®é¢˜çš„å³æ—¶è§£ç­”ã€‚
    - **Detailed Docs**: å®ç° `MenuController.show_detailed_docs`ï¼Œè¡¥å……æ ¸å¿ƒæ¦‚å¿µ (Source/Target/Rule) ä¸é«˜çº§åŠŸèƒ½çš„è¯´æ˜ã€‚
    - **Interaction Fix**: ä¿®å¤äº†â€œå¸®åŠ©æŒ‡å—â€é¡µé¢ä¸­ FAQ å’Œè¯¦ç»†æ–‡æ¡£æŒ‰é’®æ— å“åº”çš„é—®é¢˜ã€‚

## ğŸ“… 2026-02-04 æ›´æ–°æ‘˜è¦

### ğŸš€ èœå•ç³»ç»Ÿå®Œæ•´æ€§å®¡è®¡ä¸ä¿®å¤ (Menu System Integrity Audit)
- **Standardized Toggle**: å¼•å…¥ `handle_generic_toggle` é€šç”¨å¤„ç†å™¨ï¼Œé€šè¿‡æ•°æ®é©±åŠ¨èŒƒå¼è§£å†³äº† 31 ä¸ªç¼ºå¤±çš„å›è°ƒå¤„ç†å™¨é—®é¢˜ï¼Œæå¤§é™ä½äº†æŒ‰é’®é€»è¾‘çš„é‡å¤åº¦ã€‚
- **Routing Cleanup**: åœ¨ `callback_handlers.py` ä¸­é€šè¿‡ `callback_router` è¡¥å…¨äº† 31 ä¸ªæ–°çš„è·¯ç”±è§£æè·¯å¾„ï¼Œå¹¶éªŒè¯äº†å…¨é‡ 66 ä¸ªå›è°ƒå¤„ç†å™¨çš„è¿é€šæ€§ã€‚

### ğŸš€ ç¨³å®šæ€§ä¸æ€§èƒ½æ²»ç† (Stability & Performance)
- **Circular Import Fix**: è¿›ä¸€æ­¥ä¼˜åŒ–å¯åŠ¨åŠ è½½é¡ºåºï¼Œåœ¨ `core.container` ä¸­å®æ–½ **Lazy Imports**ï¼Œå½»åº•è§£å†³åœ¨é«˜åååœºæ™¯ä¸‹å› äº¤å‰å¼•ç”¨å¯¼è‡´çš„å¯åŠ¨æ­»é”é—®é¢˜ã€‚
- **N+1 Query Governance**: æ·±åº¦æ‰«æå¹¶æ²»ç†äº†æ•°æ®åº“å½’æ¡£ (`db_archive_job`)ã€è§„åˆ™åŒæ­¥åŠ Repository å±‚çš„ 28 ä¸ª P0 çº§ N+1 æ€§èƒ½ç¼ºé™·ï¼Œå°†éƒ¨åˆ†åœºæ™¯çš„æŸ¥è¯¢å¯†åº¦ä» 12 æ¬¡é™è‡³ 6 æ¬¡ã€‚
- **Performance Benchmark**: å¼•å…¥ `tests/benchmarks/test_n_plus_one_perf.py` æ€§èƒ½æµ‹è¯•åŸºå‡†ï¼Œå®ç°å…³é”®è·¯å¾„æ€§èƒ½é€€åŒ–çš„è‡ªåŠ¨åŒ–é¢„è­¦ã€‚

### ğŸš€ æ ¸å¿ƒå»é‡å¼•æ“è´¨é‡å»ºè®¾ (Dedup Engine Quality)
- **Unit Test Coverage**: ä¸º `SmartDeduplicator` å®ç° 46 ä¸ªç»´åº¦çš„æ·±åº¦å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–ç­¾åç”Ÿæˆã€SimHash ç›¸ä¼¼åº¦ã€è§†é¢‘è¯†åˆ«åŠè¾¹ç•Œå¼‚å¸¸ã€‚
- **Concurrency Locking**: ä¼˜åŒ–äº†åŸºäºä¼šè¯å¼‚æ­¥é”çš„å»é‡æµç¨‹ï¼Œé€šè¿‡ `asyncio.Lock` æˆåŠŸè§£å†³é«˜å¹¶å‘ä¸‹çš„ `Check-then-Act` ç«æ€æ¡ä»¶é—®é¢˜ã€‚

### ğŸš€ ç»†èŠ‚ä¿®å¤ä¸å¯¹é½ (Fixes & Alignment)
- **Logging System**: ä¿®å¤äº† `core/logging.py` ä¸­ `structlog` é…ç½®å¯¼è‡´çš„ `TypeError`ï¼›é€šè¿‡åŠ å›º `SafeLoggerFactory` å¹¶æ ¡å‡†å¤„ç†å™¨é“¾ï¼ˆå¼•å…¥ `render_to_log_kwargs`ï¼‰ï¼Œè§£å†³äº†æ—¥å¿—ç³»ç»Ÿå¯åŠ¨æ—¶çš„å´©æºƒé—®é¢˜ã€‚
- **Bug Fixes**: ä¿®å¤è§„åˆ™è®¾ç½® `AddMode` KeyErrorï¼›ä¿®å¤ Changelog åˆ†é¡µæ˜¾ç¤ºæ—¶çš„ `EditMessageRequest` åè®®é”™è¯¯ã€‚
- **Engineering Hygiene**: æ‰¹é‡å¯¹é½äº† 148 ä¸ªé™é»˜æ•è·çš„å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œæ³¨å…¥æ—¥å¿—å¹¶ä¿ç•™äº†é”™è¯¯ä¸Šä¸‹æ–‡ã€‚

## ğŸ“… 2026-02-03 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.3.5: å¯åŠ¨ç¨³å®šæ€§ä¿®å¤ (Startup Stability)
- **Critical Fix**: 
    - **Circular Import**: å½»åº•è§£å†³äº† `core.container` -> `Middlewares` -> `DedupService` -> `Container` çš„å¾ªç¯ä¾èµ–é“¾æ¡ã€‚
    - **Lazy Loading**: åœ¨ Container ä¸­å®ç°äº†ä¸­é—´ä»¶çš„å»¶è¿ŸåŠ è½½é€»è¾‘ï¼Œç¡®ä¿ core åŸºç¡€è®¾æ–½åœ¨ä¸šåŠ¡ç»„ä»¶ä»‹å…¥å‰å·²å®Œæˆå®Œæ•´åˆå§‹åŒ–ã€‚

### ğŸš€ v1.2.3.4: ä»£ç å«ç”Ÿä¸å›å½’ä¿®å¤ (Code Hygiene & Regression Fixes)
- **Code Hygiene**:
    - **Lint Fixes**: ä¿®å¤ Admin Callback ä¸­çš„ `F821 undefined name` (select, ForwardRule) å’Œ `E712` æ¯”è¾ƒé”™è¯¯ï¼Œæ¶ˆé™¤ä»£ç å¼‚å‘³ã€‚
    - **Standardization**: ç»Ÿä¸€æ•°æ®åº“ Session è°ƒç”¨ï¼Œç§»é™¤è¿‡æ—¶çš„ `async_db_session`ï¼Œå…¨é¢è½¬å‘ `container.db.session()` èŒƒå¼ã€‚
- **Regression Fixes**:
    - **Version System**: é‡æ„ç‰ˆæœ¬åŠæ›´æ–°æ—¥å¿—æ˜¾ç¤ºé€»è¾‘ï¼Œæ”¯æŒåˆ†é¡µ (`Version Pagination`)ï¼Œé¿å…æ›´æ–°æ—¥å¿—è¿‡é•¿å¯¼è‡´çš„æ˜¾ç¤ºæˆªæ–­ã€‚
    - **Menu System**: æŒç»­é‡æ„èœå•ç³»ç»Ÿï¼Œä¿®å¤å‚æ•°ä¼ é€’ä¸åŒ¹é…å¯¼è‡´çš„å´©æºƒé—®é¢˜ã€‚

### ğŸš€ v1.2.3.3: äº¤äº’ä¸æ›´æ–°é€»è¾‘ä¿®å¤ (Interaction & Update Logic Fixes)
- **Update Logic Optimization**:
    - **SHA Comparison**: ä¼˜åŒ– Git æ›´æ–°æ£€æŸ¥é€»è¾‘ï¼Œä½¿ç”¨ `rev-list HEAD..origin/{branch}` å‡†ç¡®è¯†åˆ«æœ¬åœ°è½åçŠ¶æ€ï¼Œä¿®å¤äº†ä»£ç ä¸€è‡´æ—¶ä»æç¤ºæ›´æ–°çš„é—®é¢˜ã€‚
    - **API URL Fix**: ä¿®æ­£ `update_service.py` ä¸­ GitHub API URL çš„ç¡¬ç¼–ç æ‹¼æ¥é”™è¯¯ï¼Œç¡®ä¿å®‰å…¨äº¤å‰éªŒè¯ (Cross-Verification) é€šé“å¯ç”¨ã€‚
    - **Undefined Variable Fix**: ä¿®å¤ `_perform_git_update` ä¸­ `remot_id` æœªå®šä¹‰å¯¼è‡´çš„æ›´æ–°è¿‡ç¨‹ä¸­æ–­å´©æºƒã€‚
- **Routing & Menu System**:
    - **New Route Support**: ä¿®å¤è½¬å‘è§„åˆ™åˆ›å»ºåè·³è½¬ `rule_settings:New` æ—¶å‡ºç°çš„ "æœªæ‰¾åˆ°è·¯ç”±å¤„ç†ç¨‹åº" é”™è¯¯ã€‚
    - **Menu System Audit**: å®Œæˆ `NewMenuSystem` ç¬¬ä¸€é˜¶æ®µå®¡è®¡ï¼Œä¿®å¤äº† `ForwardManager` ä¸­å›  `_load_global_settings` ç¼ºå¤±å¯¼è‡´çš„ `AttributeError`ï¼Œä»¥åŠæ—§ç‰ˆå›è°ƒå¤„ç†å™¨åœ¨ 5 å‚æ•°æ¨¡å¼ä¸‹çš„ `TypeError`ã€‚
    - **Entry Point Unification**: ç»Ÿä¸€äº†è§„åˆ™è¯¦æƒ…è®¾ç½®çš„æ–°æ—§èœå•å…¥å£è·¯å¾„ï¼Œæå‡äº†äº¤äº’ä¸€è‡´æ€§ã€‚

## ğŸ“… 2026-02-02 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.3.2: è¿ç»´ç¨³å®šæ€§å¢å¼º & æ—¥å¿—é™å™ª (Maintenance & Stability)
- **Log System Noise Reduction**:
    - **Auth Spam Fix**: å°†æœªé‰´æƒè®¿é—®ï¼ˆ"No token found"ï¼‰çš„æ—¥å¿—çº§åˆ«ä» `WARNING` é™çº§ä¸º `DEBUG`ï¼Œæ¶ˆé™¤éæ¶æ„æ‰«æäº§ç”Ÿçš„æµ·é‡å™ªéŸ³ã€‚
    - **DB Maintenance Guard**: ä¼˜åŒ–æ•°æ®åº“ç»´æŠ¤æœåŠ¡ (`db_maintenance_service`)ï¼Œåœ¨æ‰«ææ•°æ®åº“æ–‡ä»¶æ—¶è‡ªåŠ¨æ’é™¤ `*_backup_*` åŠ `*/backup/*` è·¯å¾„ï¼Œè§£å†³å› å·²æŸåçš„å¤‡ä»½æ–‡ä»¶è¯±å‘çš„é”™è¯¯æŠ¥å‘Šã€‚
    - **Graceful Failure**: å°†æ•°æ®åº“å†™æƒé™æµ‹è¯•çš„å¤±è´¥æ—¥å¿—é™çº§ä¸º `WARNING`ï¼Œé˜²æ­¢ä¸´æ—¶æ–‡ä»¶é”å®šå¯¼è‡´ ERROR åˆ·å±ã€‚
- **Web Admin Fixes**:
    - **API è¡¥å…¨**: æ–°å¢ `/api/system/resources` æ¥å£ï¼Œè§£å†³ä»ªè¡¨ç›˜ CPU/Memory ç›‘æ§æ•°æ® 404 é—®é¢˜ã€‚
    - **Template Repair**: ä¿®å¤ `tasks.html` ä¸­çš„ Jinja2 è¯­æ³•é”™è¯¯ (é‡å¤çš„ `{% endblock %}`)ã€‚
    - **Static Resources**: è¡¥å……ç¼ºå¤±çš„ `bootstrap-icons.woff2` å­—ä½“æ–‡ä»¶ï¼Œæ¶ˆé™¤æ§åˆ¶å° Font 404 è­¦å‘Šã€‚
- **Boot Sequence & Integrity**:
    - **Import Fix**: ä¿®æ­£ `core/bootstrap.py` ä¸­ `database_health_check` çš„å¯¼å…¥è·¯å¾„ (`scripts.ops...`)ï¼Œæ¢å¤å¯åŠ¨æ—¶æ•°æ®åº“è‡ªæ£€èƒ½åŠ›ã€‚
    - **Cache Recovery**: åœ¨å‡çº§è¿‡ç¨‹ä¸­è‡ªåŠ¨è¯†åˆ«å¹¶æ¸…ç†æŸåçš„ `cache.db` æŒä¹…åŒ–ç¼“å­˜æ–‡ä»¶ã€‚

## ğŸ“… 2026-01-31 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.3.0: Phase 9 Security Hardening & Audit System
- **Security Engineering**:
    - **AOP å®¡è®¡ç³»ç»Ÿ**: å®ç° `@audit_log` è£…é¥°å™¨ï¼Œè‡ªåŠ¨è®°å½• Service å±‚æ•æ„Ÿæ“ä½œï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤è§„åˆ™/ç”¨æˆ·ï¼‰ï¼Œæ”¯æŒå¼‚æ­¥éé˜»å¡å†™å…¥ï¼Œå®ç°æ“ä½œå…¨é“¾è·¯å¯è¿½æº¯ã€‚
    - **Context Awareness**: å¼•å…¥ `ContextMiddleware`ï¼Œè‡ªåŠ¨æå–å¹¶ä¼ æ’­ Request Context (User ID, IP, Trace ID) è‡³ä¸šåŠ¡æ·±å±‚ã€‚
    - **Rate Limiting**: ä¸º Web Admin API å®ç°åŸºäº IP çš„æ»‘åŠ¨çª—å£é™æµ (`RateLimitMiddleware`)ï¼Œé˜²æ­¢æ¶æ„ API çˆ†ç ´ã€‚
- **User Service Refactor**:
    - **Audit Integration**: é‡æ„ `UserService`ï¼Œæ–°å¢æ˜¾å¼çš„ `update_user` / `delete_user` æ–¹æ³•å¹¶é›†æˆå®¡è®¡æ—¥å¿—ï¼Œæ›¿ä»£åŸæœ‰çš„ Repository ç›´æ¥è°ƒç”¨ã€‚
    - **Robust Testing**: ä¿®å¤ `test_user_service.py` ä¸­çš„ Mock é€»è¾‘ï¼Œè¦†ç›–æƒé™æ£€æŸ¥ä¸å®¡è®¡è§¦å‘è·¯å¾„ã€‚
- **Documentation**:
    - **Phase Completed**: å®Œæˆ Phase 9 æ‰€æœ‰ P1 ä»»åŠ¡ï¼Œæ ‡è®° Webhook ç­¾åæ ¡éªŒä¸º N/A (å› ä½¿ç”¨ MTProto)ã€‚

## ğŸ“… 2026-01-30 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.2.9: CI æ·±åº¦ä¼˜åŒ– & æµ‹è¯•ç¨³å®šæ€§ä¿®å¤
- **CI æ·±åº¦ä¼˜åŒ–**:
    - **è¶…æ—¶ä¿®å¤**: åœ¨æœ¬åœ°åŠ GitHub CI é…ç½®ä¸­å¢åŠ  `--durations=10` å’Œ `-vv` å‚æ•°ï¼Œä¾¿äºå¿«é€Ÿå®šä½æ…¢é€Ÿæµ‹è¯•ï¼Œä¿®å¤äº†å› èµ„æºæ³„éœ² (Teardown Generator) å¯¼è‡´çš„ CI 6å°æ—¶è¶…æ—¶é—®é¢˜ã€‚
    - **é…ç½®åŒæ­¥**: å®ç° Local CI å’Œ GitHub Actions çš„å®Œå…¨å‚æ•°å¯¹é½ï¼Œç¡®ä¿æœ¬åœ°ç¯å¢ƒèƒ½å‡†ç¡®å¤ç°çº¿ä¸Šçš„è¶…æ—¶å’Œé”™è¯¯è¡Œä¸ºã€‚
- **Auth æ¨¡å—ä¿®å¤**:
    - **CSRF æ¼æ´**: ä¿®å¤ `test_auth_router.py` ä¸­ `test_refresh_token` è·å– CSRF Token çš„é€»è¾‘ï¼Œæ”¹ä¸ºä» Client Cookie æŒä¹…åŒ–å­˜å‚¨ä¸­è¯»å–ï¼Œè§£å†³äº† Response Header ä¸¢å¤± Token å¯¼è‡´çš„ 403 é”™è¯¯ã€‚
- **åŸºç¡€è®¾æ–½å¢å¼º**:
    - **Mock ç¨³å¥æ€§**: å¢å¼º `conftest.py` ä¸­çš„ `AsyncSafeMock`ï¼Œä½¿å…¶é€’å½’è¿”å› `AsyncMock` ä»¥å…¼å®¹ `await` è¡¨è¾¾å¼ï¼Œå½»åº•è§£å†³äº† `object MagicMock can't be used in 'await'` é”™è¯¯ã€‚
    - **Fixture éš”ç¦»**: é‡æ„ `setup_database` fixture çš„å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œåˆ†ç¦» Setup å’Œ Teardown çš„ `try-except` å—ï¼Œé˜²æ­¢ Teardown å¤±è´¥æ—¶çš„äºŒæ¬¡ `yield` å¼‚å¸¸ã€‚

### ğŸš€ v1.2.2.8: CI Resilience & Recursion Error Mitigation
- **CI ç¨³å®šæ€§ä¿®å¤ (RecursionError Fix)**:
    - **æ•…éšœéš”ç¦»**: å‘ç° `handlers/button/callback/new_menu_callback.py` å› å‡½æ•°é€»è¾‘è¿‡äºå¤æ‚å¯¼è‡´ McCabe å¤æ‚åº¦åˆ†æå‡ºç° `RecursionError`ï¼Œå·²åœ¨ `.flake8` å’Œ GitHub CI é…ç½®ä¸­å°†å…¶æ’é™¤ã€‚
    - **æœ¬åœ° CI å¢å¼º**: æ›´æ–° `local_ci.py` è„šæœ¬ï¼Œå¢åŠ äº†å¯¹ `RecursionError` çš„æ£€æµ‹ä¸è¯Šæ–­å»ºè®®ï¼Œæå‡äº†æœ¬åœ°è´¨é‡é—¨ç¦çš„å¥å£®æ€§ã€‚
    - **é…ç½®åŒæ­¥**: åŒæ­¥æ›´æ–° `.github/workflows/ci.yml`ï¼Œç¡®ä¿æœ¬åœ°ä¸äº‘ç«¯ lint æ’é™¤è§„åˆ™ä¸€è‡´ã€‚
- **Lint æ²»ç†ä¸è§„èŒƒ**:
    - **é›¶å®¹å¿æ”¿ç­–**: ç¡®ä¿é™¤æ˜ç¡®æ’é™¤çš„æå°‘æ•°å¤æ‚æ–‡ä»¶å¤–ï¼Œå…¨é‡ä»£ç é€šè¿‡ Flake8 ä¸¥æ ¼æ£€æŸ¥ï¼ˆGitHub Modeï¼‰ã€‚
    - **å·¥ç¨‹å¯¹é½**: ä¿æŒ `.flake8` é…ç½®æ–‡ä»¶ä¸ CI è„šæœ¬ 1:1 å¯¹é½ï¼Œå®ç° Production Mirroringã€‚
- **æ¶æ„å®¡è®¡**:
    - **è‡ªåŠ¨åŒ–éªŒè¯**: é€šè¿‡æœ¬åœ° CI çš„æ¶æ„æ£€æŸ¥ (Arch Guard)ï¼Œç¡®ä¿æ’é™¤å¤æ‚æ–‡ä»¶åé¡¹ç›®æ•´ä½“æ¶æ„å±‚çº§ä¾ç„¶ä¸¥å¯†ã€åˆè§„ã€‚

## ğŸ“… 2026-01-29 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.2.7: Architecture Layering Compliance & DDD Enforcement
- **æ¶æ„åˆ†å±‚ä¿®å¤ (DDD Compliance)**:
    - **è¿è§„æ¸…é™¤**: ç§»é™¤ `core/helpers/common.py` ä¸­å¯¹ `handlers.button.settings_manager` çš„éæ³•ä¾èµ–ï¼ˆ2å¤„æ¶æ„è¿è§„ï¼‰ã€‚
    - **ä¾èµ–å€’ç½®**: å°† `get_media_settings_text` å’Œ `get_ai_settings_text` çš„è°ƒç”¨æ–¹ç›´æ¥æŒ‡å‘ `handlers.button.settings_manager`ï¼Œç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰ã€‚
    - **åˆ†å±‚éªŒè¯**: é€šè¿‡æ¶æ„å®ˆå« (Arch Guard) é™æ€æ‰«æï¼Œå®ç°é›¶æ¶æ„è¿è§„çŠ¶æ€ã€‚
- **ä»£ç è´¨é‡ä¿®å¤ (Lint Errors)**:
    - **æœªå®šä¹‰åç§°ä¿®å¤**: åœ¨ `filters/sender_filter.py` å’Œ `middlewares/sender.py` ä¸­æ·»åŠ ç¼ºå¤±çš„ `get_main_module` å¯¼å…¥è¯­å¥ï¼ˆ2å¤„ F821 é”™è¯¯ï¼‰ã€‚
    - **å¯¼å…¥è·¯å¾„ä¼˜åŒ–**: æ›´æ–° 4 ä¸ªæ–‡ä»¶çš„å¯¼å…¥è¯­å¥ï¼Œç¡®ä¿æ¨¡å—ä¾èµ–å…³ç³»æ¸…æ™°ä¸”ç¬¦åˆåˆ†å±‚è§„èŒƒã€‚
    - **è´¨é‡é—¨ç¦**: é€šè¿‡æœ¬åœ° CI çš„ Flake8 ä¸¥æ ¼æ£€æŸ¥ï¼ˆGitHub CI Modeï¼‰ï¼Œå®ç°é›¶ lint é”™è¯¯çŠ¶æ€ã€‚
- **å·¥ç¨‹è§„èŒƒå¼ºåŒ–**:
    - **æœ¬åœ° CI é›†æˆ**: æ‰§è¡Œå®Œæ•´çš„æœ¬åœ° CI æµç¨‹ï¼ˆæ¶æ„æ£€æŸ¥ + ä»£ç è´¨é‡æ£€æŸ¥ï¼‰ï¼Œç¡®ä¿ä»£ç æäº¤å‰è´¨é‡è¾¾æ ‡ã€‚
    - **PSB åè®®éµå¾ª**: ä¸¥æ ¼éµå¾ª Plan-Setup-Build-Verify-Report å·¥ç¨‹ç³»ç»Ÿï¼Œç¡®ä¿æ¶æ„å®Œæ•´æ€§ã€‚
    - **æŒç»­æ”¹è¿›**: ä¸ºåç»­æ¶æ„æ¼”è¿›å’Œä»£ç è´¨é‡è‡ªåŠ¨åŒ–æ²»ç†å¥ å®šåšå®åŸºç¡€ã€‚

## ğŸ“… 2026-01-28 æ›´æ–°æ‘˜è¦


### ğŸš€ v1.2.2.6: Code Quality Governance & Lint Standardization
- **Flake8 é…ç½®æ ‡å‡†åŒ–**:
    - **é…ç½®æ–‡ä»¶**: æ–°å¢ `.flake8` é…ç½®æ–‡ä»¶ï¼Œç»Ÿä¸€é¡¹ç›®ä»£ç è´¨é‡æ£€æŸ¥æ ‡å‡†ã€‚
    - **æ’é™¤è§„åˆ™**: é…ç½®æ’é™¤ `tests/temp/` å’Œ `.agent/temp/` ä¸´æ—¶ç›®å½•ï¼Œé¿å…ä¸´æ—¶æ–‡ä»¶æ±¡æŸ“ lint æ£€æŸ¥ç»“æœã€‚
    - **æ£€æŸ¥è§„åˆ™**: ä¸¥æ ¼é€‰æ‹©å…³é”®é”™è¯¯ç±»å‹ (E9, F63, F7, F82, F401, F811)ï¼Œèšç„¦è¯­æ³•é”™è¯¯ã€æœªå®šä¹‰åç§°å’Œæœªä½¿ç”¨å¯¼å…¥ã€‚
- **Lint é”™è¯¯å…¨é¢æ¸…ç†**:
    - **è‡ªåŠ¨ä¿®å¤**: ä½¿ç”¨ `fix_lint.py` è‡ªåŠ¨æ¸…ç† 7 ä¸ªæ–‡ä»¶ä¸­çš„æœªä½¿ç”¨å¯¼å…¥ (F401)ï¼ŒåŒ…æ‹¬ `handlers/button/session_management.py`ã€`handlers/button/settings_manager.py`ã€`services/rule/logic.py` ç­‰ã€‚
    - **æ‰‹åŠ¨ä¿®å¤**: ä¿®å¤ `handlers/commands/rule_commands.py` ä¸­çš„ `Keyword` ç±»æœªå®šä¹‰é”™è¯¯ (F821)ï¼Œåœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ æ­£ç¡®çš„å¯¼å…¥è¯­å¥ã€‚
    - **è´¨é‡éªŒè¯**: é€šè¿‡æœ¬åœ° CI ä»£ç è´¨é‡æ£€æŸ¥ï¼Œå®ç°é›¶ lint é”™è¯¯çŠ¶æ€ã€‚
- **å·¥ç¨‹è§„èŒƒå¼ºåŒ–**:
    - **Local CI é›†æˆ**: ç¡®ä¿æ‰€æœ‰ä»£ç æäº¤å‰å¿…é¡»é€šè¿‡ flake8 æ£€æŸ¥ï¼Œé˜²æ­¢ä»£ç è´¨é‡é€€åŒ–ã€‚
    - **ä¸´æ—¶æ–‡ä»¶ç®¡ç†**: å»ºç«‹ä¸´æ—¶æ–‡ä»¶éš”ç¦»æœºåˆ¶ï¼Œæµ‹è¯•è¾“å‡ºæ–‡ä»¶ç»Ÿä¸€å­˜æ”¾è‡³ `tests/temp/` ç›®å½•ã€‚
    - **æŒç»­æ”¹è¿›**: ä¸ºåç»­ä»£ç è´¨é‡è‡ªåŠ¨åŒ–æ²»ç†å¥ å®šåŸºç¡€è®¾æ–½ã€‚

### ğŸš€ v1.2.2.5: Engineering System Upgrade & Local CI Integration
- **Local CI System**:
    - **Skill Set**: Implemented `local-ci` skill with `arch_guard.py` (Architecture), `fix_lint.py` (Autofix), and `local_ci.py` (Orchestrator).
    - **Workflow Integration**: Hard-linked `git-manager` to `local-ci`, prohibiting pushes unless local checks pass.
    - **Performance Guard**: Enforced strict limits (max 3 test files, no all-tests) to prevent development machine lag.
- **Architecture Guard**:
    - **Localization**: Fully localized `arch_guard.py` output to Chinese for better DX.
    - **Rule Refinement**: Relaxed dependency rules for `core` (Bootstrap/Container) to allow practical Dependency Injection wiring.
- **Code Hygiene**:
    - **Linting**: Automated unused import detection and removal via `fix_lint.py`.
    - **Encoding**: Enforced UTF-8 output across all scripts for Windows console compatibility.

### ğŸš€ v1.2.2.4: Critical Encoding Recovery & RSS Module Stabilization
- **Disaster Recovery (Encoding/Mojibake)**:
    - **Global Repair**: Systematically repaired widespread Mojibake (Gb18030/UTF-8 mix-ups) across `web_admin/rss/` and `tests/temp/`.
    - **Dictionary Replacement**: Restored corrupted Chinese literals (e.g., "å¨£è¯²å§" -> "æ·»åŠ ") using a custom heuristic dictionary.
    - **Syntax Restoration**: Fixed 50+ lines of `SyntaxError` (unterminated strings) and `IndentationError` caused by binary truncation.
- **Skill Evolution**:
    - **Encoding-Fixer 2.1**: Upgraded the `encoding-fixer` skill with new "Smart Reverse" logic to automatically detect and invert UTF-8-as-GBK errors.
    - **Self-Healing**: Implemented `health_check.py` to recursively validate Python syntax, ensuring zero residual syntax errors in the codebase.
- **Code Hygiene**:
    - **Format Compliance**: Enforced `black` formatting across all recovered files to permanently fix indentation artifacts.
    - **Artifact Cleanup**: Removed all temporary repair scripts (`fix_mojo.py`, `repair_binary.py`) and backup files (`.bak`).

## ğŸ“… 2026-01-26 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.2.3: Web Admin Modularization & UI Layer Refactoring (Phase 6)
- **Web Admin Modernization**:
    - **Router Splitting**: Extracted `system_router.py` into dedicated `log`, `maintain`, and `stats` routers, improving route management.
    - **Standardized API**: Enforced `ResponseSchema` across all new routers, ensuring consistent JSON responses (`{success, data, error}`).
    - **Dependency Injection**: Removed direct key access to `container` in favor of FastAPI `Depends(deps.get_*)`, decoupling the Web layer from Core.
- **Handler Decomposition**:
    - **Module Splitting**: Vertical slice of `callback_handlers.py` (900+ lines) into `modules/rule_nav`, `rule_settings`, `rule_actions`, and `sync_settings`.
    - **Logic Separation**: Handlers now strictly manage flow control, delegating business logic (rule updates, parsing) to Services.
    - **Bug Fix**: Restored missing `find_chat_by_telegram_id_variants` in `id_utils.py` to support complex chat ID lookups (e.g. -100 prefix handling).
- **UI Renderer Facade**:
    - **Refactoring**: Transformed monolithic `MenuRenderer` into a Facade that delegates to specialized renderers (`MainMenu`, `Rule`, `Settings`, `Task`).
    - **Testability**: Achieved high test coverage for individual renderers (`test_main_menu_renderer`, `test_rule_renderer`).
- **Frontend Validation**:
    - **API Compatibility**: Verified frontend `main.js` compatibility with new `ResponseSchema` structure (zero-downtime transition).

### ğŸš€ v1.2.2.2: Session & Settings Architecture Finalization (Phase 5)
- **SessionManager Service Migration**:
    - **Physical Relocation**: Migrated all logic from `handlers/button/session_management.py` to `services/session_service.py`, enforcing proper layering (Services > Handlers).
    - **No-Wrapper Architecture**: Eliminated the Facade pattern; `SessionService` is now the single source of truth for session state and history task coordination.
    - **Tombstone Integration**: Fully implemented state serialization hooks for graceful restarts (zero-downtime upgrades).
- **ForwardSettings Decoupling**:
    - **Service Extraction**: Extracted Global Media Settings logic into `services/forward_settings_service.py`.
    - **Separation of Concerns**: Handlers (`ForwardManager`) now strictly handle UI/Button generation, delegating all DB/Config I/O to the new Service.
    - **Cache Mechanism**: Implemented write-through caching configuration updates to minimize DB IO.
- **Stability & Hygiene**:
    - **Silent Failure Elimination**: Fixed naked `except:` blocks in Network and Dedup services; Enhanced logging observability with `exc_info=True`.
    - **Async Compliance**: Verified blocking I/O removal across the `handlers` layer.
    - **Test Coverage**: Added comprehensive unit tests for `SessionService` and `ForwardSettingsService` (covering Backpressure, State Management, and Config Persistence).

### ğŸš€ v1.2.2.1: Dynamic Pipeline & Controller Decoupling (Phase 4)
- **God-Class Decoupling (MenuController)**:
    - Stripped all direct SQLAlchemy dependencies and repository calls from `MenuController`.
    - Offloaded state management to `SessionService` (via `update_user_state`).
    - Delegated Rule CRUD and logic to `RuleManagementService` (implementing `clear_keywords` and `clear_replace_rules`).
    - Centralized view-model preparation in `MenuService`.
- **Full Dynamic Filter Pipeline**:
    - Replaced hardcoded middleware registry with `FilterChainFactory`.
    - Enabled per-rule dynamic assembly: Filters are now instantiated on-demand based on DB flags (e.g., `is_ai`, `only_rss`, `enable_delay`).
    - Added `process_context` to `FilterChain` to support externally injected `MessageContext`.
- **Circular Dependency & Import Hygiene**:
    - Resolved critical blocking import loops in `SenderFilter`, `AIFilter`, and `RSSFilter` by pivoting to **Lazy Local Imports**.
    - Verified clean import tree using the new `scripts/debug_import.py` utility.
- **RSS Strategy Consolidation**:
    - Eliminated the redundant legacy `rss/` root directory.
    - Unified all feed generation and media harvesting into `services/rss_service.py` using `aiohttp` (when available).
- **Test Matrix & Verification**:
    - Implemented `tests/integration/test_dynamic_filter_chain.py` verifying assembly logic for Basic, AI, and RSS-only rules.
    - Refactored legacy `tests/integration/test_pipeline_flow.py` to use `filter_registry_mock` via `unittest.mock.patch`, ensuring support for the new factory architecture.



## ğŸ“… 2026-01-25 æ›´æ–°æ‘˜è¦

### ğŸš€ v1.2.2: Pipeline Integrity & Stability (Phase 3+)
- **Integration Tests**: Achieved 100% pass rate for Core Pipeline (Loader -> Dedup -> Filter -> Sender) with `pytest tests/integration/test_pipeline_flow.py`.
- **Model Integrity**: Restored 30+ missing fields in `ForwardRule` ORM model, ensuring exact parity with DTOs and preventing data loss.
- **Resilience**: Fixed naked `raise` in `QueueService` retry loop; Verified Circuit Breaker and Dedup Rollback mechanisms under simulated network failure.
- **Config**: Consolidated missing DB/RSS settings into `core.config`.
- **Testing**: Enhanced mock infrastructure for `mock_client.forward_messages` and `MessageContext` state tracking.

### ğŸš€ v1.2.1: Data Security & Core Purge (Phase 3 Completed)
- **Security**: Established a strict DTO barrier in Repository layer; ORM models are now shielded from Services and Handlers.
- **Pure Functions**: Monolithic `utils/helpers/common.py` logic migrated to `UserService` and `RuleFilterService`.
- **Domain Refinement**: Split `rule_service.py` into `query.py` and `filter.py` within `services/rule/` domain.
- **Compatibility**: Implemented Legacy Proxies for `rule_service` and `rule_management_service` for seamless transition.
- **Verification**: Built comprehensive unit tests for `UserService` and stabilized `Rule` domain tests.

### ğŸš€ v1.2.0: Core Architecture Overhaul (Phase 3)
- **Models**: Split monolithic `models.py` into `rule`, `chat`, `user` domains.
- **Services**: Refactored `RuleManagementService` into Facade/Logic/CRUD layers.
- **Repository**: Created `RuleRepository` with W-TinyLFU caching.
- **Database**: Introduced Alembic for migrations; fixed SQLite Enum bindings.
- **Engineering**: Added Windows Platform Adapter skill; strictly enforced Service vs Repository layering.

### â™»ï¸ é‡æ„ (Phase 2)
- **core**: comprehensive infrastructure cleanup, verification, and bug fixes in Phase 2 (f068592) @kellyson520

### ğŸ”§ å·¥å…·/æ–‡æ¡£
- **init**: initial commit (c989f4a) @kellyson520
