# 🚀 QoS 5.0 (未来展望): 自治与自愈 (Autonomous & Self-Healing)

## 1. 演进方向 (Evolution)
v4 已经实现了完美的**隔离与公平**。如果要继续升级，方向不再是"怎么排队"，而是"怎么处理**极端过载** 和 **资源调度**"。
v5 将引入 **控制理论 (Control Theory)** 与 **自适应升维**。

## 2. 核心特性 (Features)

### 2.1 泳道感知自动扩缩容 (Lane-Aware Auto-Scaling)
目前的 `WorkerService` 扩容逻辑是基于"总队列深度"。
*   **v4 问题**: 10000 条垃圾消息也会触发 Worker 扩容到最大，浪费 VPS 资源。
*   **v5 方案**:
    *   **Critical/Fast 积压**: 立即扩容至 MAX (火力全开)。
    *   **Standard 积压**: 维持 MIN 或 缓慢扩容 (节能模式)。
    *   **收益**: 在垃圾流量攻击时，系统负载反而保持低位。

### 2.2 智能负载卸载 (Intelligent Load Shedding)
当 VPS 资源 (CPU/RAM) 真正耗尽时，必须只有"丢弃"才能救系统。
*   **v5 方案**:
    *   监控系统指标 (CPU > 90% 或 RAM > 85%)。
    *   触发 **Shedding Mode**: 直接拒绝/丢弃 `Standard` 泳道的所有新入队请求。
    *   保护 `Critical` 和 `Fast` 泳道不受影响。

### 2.3 动态参数调优 (Auto-Tuner)
*   `CONGESTION_PENALTY_FACTOR` (目前固定 0.5)。
*   **v5 方案**: 根据处理延迟 (Latency) 动态调整因子。
    *   延迟升高 -> 提高惩罚因子 (加速降级)。
    *   延迟降低 -> 降低惩罚因子 (放宽限制)。

## 3. 实现复杂度
*   **复杂度**: 高 (涉及跨组件指标监控、PID 控制器集成)。
*   **必要性**: 对于目前的业务规模，v4 已经足够处理 99.9% 的场景。v5 适合**千万级**消息吞吐的系统。

## 4. 建议
**当前阶段建议止步于 v4**。
因为 v4 已经解决了核心痛点（VIP 被堵、刷屏影响系统）。v5 的边际收益在目前规模下不仅不明显，反而会引入不必要的系统复杂度（Over-Engineering）。

**推荐路径**:完善 v4 -> 上线观察 -> 如有极端性能瓶颈再升级 v5。
