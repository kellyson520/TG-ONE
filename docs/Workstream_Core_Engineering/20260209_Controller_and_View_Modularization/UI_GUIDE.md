# TG ONE UI å¼€å‘å‚è€ƒæ‰‹å†Œ (UIRE-2.0)

æœ¬æ–‡æ¡£æ—¨åœ¨æŒ‡å¯¼å¼€å‘è€…å¦‚ä½•ä½¿ç”¨ `MenuBuilder` å£°æ˜å¼å¼•æ“æ„å»ºç»Ÿä¸€ã€ä¼˜é›…ä¸”é²æ£’çš„ Telegram Bot ç•Œé¢ã€‚

## 1. æ ¸å¿ƒæŒ‡å— (Philosophy)

- **å£°æ˜å¼æ„å»º**ï¼šä¸¥ç¦åœ¨ Renderer ä¸­æ‰‹åŠ¨æ‹¼æ¥å­—ç¬¦ä¸²æˆ–å¤„ç† `\n`ã€‚
- **å›¾æ ‡é©±åŠ¨**ï¼šæ‰€æœ‰çŠ¶æ€åˆ‡æ¢å’Œåˆ†ç±»æ ‡é¢˜å¿…é¡»ä½¿ç”¨ `UIStatus` ä¸­å®šä¹‰çš„å›¾æ ‡ã€‚
- **é²æ£’ä¼˜å…ˆ**ï¼šåˆ©ç”¨ Builder å†…ç½®çš„æˆªæ–­å’Œé€ƒé€¸é€»è¾‘ï¼Œé¿å…å¤„ç†åŸå§‹ç”¨æˆ·æ•°æ®æ—¶çš„æ³¨å…¥é£é™©ã€‚

## 2. åŸºç¡€ç»„ä»¶ç”¨æ³•

### 2.1 åˆå§‹åŒ–æ ‡é¢˜ä¸è·¯å¾„
```python
builder = self.new_builder()
builder.set_title("åŠŸèƒ½åç§°", icon="ğŸš€")
builder.add_breadcrumb(["é¦–é¡µ", "äºŒçº§ç›®å½•", "å½“å‰é¡µ"])
```

### 2.2 å†…å®¹åˆ†å— (Section)
æ”¯æŒçº¯æ–‡æœ¬æˆ–åˆ—è¡¨ï¼Œè‡ªå¸¦è‡ªåŠ¨æ¢è¡Œå’Œå›¾æ ‡å¯¹é½ã€‚
```python
builder.add_section("é…ç½®è¯´æ˜", "è¿™æ˜¯ä¸€æ®µè¯¦ç»†çš„æ“ä½œæŒ‡å¼•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†å¯¹é½å’Œæ¢è¡Œã€‚")
builder.add_section("æ ¸å¿ƒç»„ä»¶", [
    "å…³é”®è¯è¿‡æ»¤",
    "å†…å®¹åˆ†è¯",
    "æ™ºèƒ½å»é‡"
], icon="ğŸ’¡")
```

### 2.3 çŠ¶æ€çŸ©é˜µ (Status Grid)
ç”¨äºå±•ç¤º Key-Value æ•°æ®ï¼Œæ”¯æŒ ID ç±»æ–‡æœ¬çš„æ™ºèƒ½é¦–å°¾ç¼©ç•¥ã€‚
```python
builder.add_status_grid({
    "å½“å‰è§„åˆ™": "6000000123", # è‡ªåŠ¨ç¼©ç•¥ä¸º 600000...0123
    "è¿è¡ŒçŠ¶æ€": ("æ­£å¸¸è¿è¡Œ", UIStatus.SUCCESS),
    "å¤„ç†é€Ÿåº¦": "1.2s/msg"
})
```

### 2.4 è¿›åº¦æ¡ (Progress Bar)
```python
builder.add_progress_bar("ä»»åŠ¡è¿›åº¦", percentage)
```

## 3. æŒ‰é’®å¸ƒå±€å¼•æ“ (Layout Engine)

Builder ä¼šæ ¹æ® Label é•¿åº¦è‡ªåŠ¨è®¡ç®—ç‰©ç†è¡Œæ•°ã€‚

- **add_button(label, action)**: è‡ªåŠ¨å¹³é“ºæ’ç‰ˆã€‚
  - çŸ­æŒ‰é’® (<6 å­—ç¬¦): è‡ªåŠ¨æ¯è¡Œ 3 ä¸ªã€‚
  - ä¸­æŒ‰é’® (6-12 å­—ç¬¦): è‡ªåŠ¨æ¯è¡Œ 2 ä¸ªã€‚
  - é•¿æŒ‰é’® (>12 å­—ç¬¦): ç‹¬å ä¸€è¡Œã€‚
- **add_button_row(buttons)**: åŸå­è¡Œã€‚æŒ‰é’®ä¸ä¼šè¢«å¸ƒå±€å¼•æ“é‡æ–°æ’åˆ—ã€‚
- **å¸åº•æŒ‰é’®**: åŒ…å«â€œè¿”å›â€ã€â€œé€€å‡ºâ€ã€â€œå–æ¶ˆâ€å­—æ ·çš„æŒ‰é’®ä¼šè‡ªåŠ¨å¸å…¥åº•éƒ¨å¹¶è¿›è¡ŒåŒå¹¶åˆ—æ’ç‰ˆã€‚

## 4. è¾¹ç•Œå¤„ç†ä¸é™æµ (Robustness)

- **å…¨å±€æˆªæ–­**: æ€»å­—ç¬¦æ•°è¶…è¿‡ 3800 æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿ç•™å¤´éƒ¨å¹¶æ·»åŠ  `... (å†…å®¹å·²æˆªæ–­)`ã€‚
- **Markdown éš”ç¦»**: è‡ªåŠ¨é€ƒé€¸ `*`, `_`, `` ` ``ï¼Œé˜²æ­¢åç«¯æ•°æ®ç ´å XML/Markdown æ¸²æŸ“ã€‚
- **ID æ™ºèƒ½ç¼©ç•¥**: `TextUtil.smart_truncate` å¯¹åŒ…å«æ•°å­—çš„é•¿å­—ç¬¦ä¸²æ‰§è¡Œæ„ŸçŸ¥ç¼©ç•¥ã€‚

## 5. ç¤ºä¾‹ï¼šæ ‡å‡†è§„åˆ™è¯¦æƒ…é¡µ

```python
def render_rule_detail(self, data: Dict[str, Any]) -> ViewResult:
    rule = data.get('rule', {})
    rid = rule.get('id', 'Unknown')
    
    return (self.new_builder()
        .set_title(f"è§„åˆ™è¯¦æƒ…", icon=UIStatus.EDIT)
        .add_breadcrumb(["é¦–é¡µ", "è½¬å‘", rid])
        .add_section("è·¯ç”±ä¿¡æ¯", f"ä» `{rule.get('source')}` è½¬å‘è‡³ `{rule.get('target')}`")
        .add_status_grid({
            "æœ€åæ´»åŠ¨": rule.get('last_time', 'ä»æœª'),
            "å¥åº·åº¦": ("è‰¯å¥½", UIStatus.SUCCESS)
        })
        .add_button("ç¼–è¾‘åŸºç¡€", f"edit_basic:{rid}")
        .add_button("åˆ é™¤è§„åˆ™", f"confirm_del:{rid}", icon=UIStatus.TRASH)
        .add_button("è¿”å›åˆ—è¡¨", "list_rules", icon=UIStatus.BACK)
        .build())
```
